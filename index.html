<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignite Fitness - AI-Powered Training Platform</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="AI-powered fitness tracking with offline support and personalized coaching">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="IgniteFitness">
    <meta name="msapplication-TileColor" content="#1a1a1a">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- Accessibility Meta Tags -->
    <meta name="color-scheme" content="dark light">
    <meta name="prefers-color-scheme" content="dark">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Critical Resource Preloading -->
    <link rel="preload" href="/styles/main.css" as="style" crossorigin="anonymous">
    <link rel="preload" href="/styles/mobile-first.css" as="style" crossorigin="anonymous">
    <link rel="preload" href="/js/app.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="/js/modules/ui/VirtualList.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="/js/modules/cache/LRUCache.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    
    <!-- DNS Prefetch for External Resources -->
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- Stylesheets -->
    <!-- Mobile-First Styles -->
    <link rel="stylesheet" href="styles/mobile-first.css">
    <link rel="stylesheet" href="styles/design-tokens.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/persistent-header.css">
    <link rel="stylesheet" href="styles/workout-flow.css">
    <link rel="stylesheet" href="styles/workout-timer.css">
    <link rel="stylesheet" href="styles/recovery-dashboard.css">
    <link rel="stylesheet" href="styles/nutrition-card.css">
    <link rel="stylesheet" href="styles/why-this.css">
    <link rel="stylesheet" href="styles/why-panel.css">
    <link rel="stylesheet" href="styles/charts.css">
    <link rel="stylesheet" href="styles/strava-import.css">
    
    <!-- Existing Styles -->
    <link rel="stylesheet" href="styles/main.css">
    
    <!-- Onboarding and Dashboard Styles -->
    <style>
        /* Onboarding Styles */
        .onboarding-content {
            max-width: 600px;
            width: 90%;
        }
        
        .onboarding-question {
            padding: 20px 0;
        }
        
        .question-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        
        .option-card {
            display: flex;
            align-items: center;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option-card:hover {
            border-color: #4299e1;
            background-color: #f7fafc;
        }
        
        .option-card input[type="radio"] {
            margin-right: 12px;
        }
        
        .option-card input[type="radio"]:checked + .option-content {
            color: #2d3748;
        }
        
        .option-card:has(input[type="radio"]:checked) {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        
        .option-content {
            flex: 1;
        }
        
        .option-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }
        
        .option-description {
            font-size: 14px;
            color: #718096;
        }
        
        .onboarding-progress {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #718096;
        }
        
        /* Dashboard Styles */
        .dashboard-container {
            padding: 20px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .dashboard-mode-indicator {
            display: flex;
            gap: 8px;
        }
        
        .mode-badge, .role-badge {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .mode-badge {
            background-color: #ebf8ff;
            color: #2b6cb0;
        }
        
        .role-badge {
            background-color: #f0fff4;
            color: #2f855a;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .dashboard-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .dashboard-card h3 {
            margin: 0 0 12px 0;
            color: #2d3748;
            font-size: 18px;
        }
        
        .dashboard-card p {
            margin: 8px 0;
            color: #718096;
            font-size: 14px;
        }
        
        /* Dashboard Mode Specific Styles */
        .dashboard-container[data-mode="basics"] .dashboard-card {
            background: #f7fafc;
        }
        
        .dashboard-container[data-mode="basics"] .dashboard-card h3 {
            color: #4a5568;
        }
        
        .dashboard-container[data-mode="all_data"] .dashboard-card {
            border-left: 4px solid #4299e1;
        }
        
        /* Preferences Modal */
        .preferences-section {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .preferences-section:last-child {
            border-bottom: none;
        }
        
        .preferences-section h4 {
            margin: 0 0 12px 0;
            color: #2d3748;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            background: #f7fafc;
            color: #2d3748;
            transition: all 0.2s;
        }
        
        .radio-group label:hover {
            background: #edf2f7;
            border: 1px solid #cbd5e0;
        }
        
        .radio-group input[type="radio"] {
            margin-right: 12px;
        }
        
        .radio-group input[type="radio"]:checked + span {
            font-weight: 600;
            color: #4299e1;
        }
        
        /* Fix tab content text color */
        .tab-content {
            color: #2d3748 !important;
        }
        
        .tab-content h3,
        .tab-content h4,
        .tab-content h5 {
            color: #2d3748 !important;
        }
        
        .tab-content p,
        .tab-content label {
            color: #4a5568 !important;
        }
        
        /* Dashboard Controls */
        .dashboard-controls {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        
        /* Daily Check-in Styles */
        .checkin-content {
            max-width: 700px;
            width: 95%;
        }
        
        /* Height Input Styles */
        .height-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .height-unit {
            width: 80px;
            flex-shrink: 0;
        }
        
        .height-feet-inches {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .height-feet-inches input {
            width: 80px;
        }
        
        /* Sport-Specific Training Styles */
        .sport-specific-options {
            margin-top: 16px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        /* Training Goals Styles */
        .goals-label {
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 12px;
            display: block;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .goal-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #f7fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .goal-option:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }
        
        .goal-option input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .goal-option input[type="checkbox"]:checked + span {
            color: #2b6cb0;
            font-weight: 600;
        }
        
        /* Workout Calendar Styles */
        .workout-calendar-section {
            margin-bottom: 32px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }
        
        .calendar-header {
            margin-bottom: 16px;
        }
        
        .calendar-header h4 {
            color: #2d3748;
            margin-bottom: 12px;
        }
        
        .calendar-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            margin: 16px 0;
        }
        
        .calendar-day {
            background: #f8fafc;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .day-header {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            text-align: center;
            font-size: 14px;
        }
        
        .activity-select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* Save Status Styles */
        .save-status {
            margin-top: 12px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            display: none;
        }
        
        .save-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .save-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        /* Injury Prevention Styles */
        .injury-prevention-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff5f5;
            border-radius: 8px;
            border: 1px solid #fed7d7;
        }
        
        .injury-prevention-options {
            margin-top: 16px;
            padding: 16px;
            background: #fef5e7;
            border-radius: 8px;
            border: 1px solid #fbd38d;
        }
        
        .injury-option {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            background: #fff;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .injury-option:hover {
            background: #f7fafc;
            border-color: #cbd5e0;
        }
        
        .injury-option input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .injury-recommendations {
            margin-top: 16px;
            padding: 12px;
            background: #e6fffa;
            border-radius: 6px;
            border: 1px solid #81e6d9;
        }
        
        .injury-prevention-tab {
            margin-bottom: 32px;
            padding: 20px;
            background: #f0fff4;
            border-radius: 8px;
            border: 1px solid #9ae6b4;
        }
        
        .prevention-exercises {
            margin-top: 16px;
        }
        
        .exercise-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }
        
        .exercise-item {
            padding: 12px;
            background: #fff;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .exercise-item h6 {
            margin: 0 0 8px 0;
            color: #2d3748;
            font-size: 14px;
            font-weight: 600;
        }
        
        .exercise-item p {
            margin: 0;
            color: #718096;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .exercise-item .exercise-type {
            display: inline-block;
            padding: 2px 6px;
            background: #edf2f7;
            color: #4a5568;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
            margin-top: 6px;
        }
        
        /* ACL Prevention Styles */
        .acl-prevention-section {
            margin-top: 20px;
            padding: 16px;
            background: #fff5f5;
            border-radius: 8px;
            border: 1px solid #feb2b2;
        }
        
        .acl-protocol {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }
        
        .protocol-phase {
            padding: 12px;
            background: #fff;
            border-radius: 6px;
            border: 1px solid #fed7d7;
        }
        
        .protocol-phase h6 {
            margin: 0 0 8px 0;
            color: #c53030;
            font-size: 14px;
            font-weight: 600;
        }
        
        .protocol-phase ul {
            margin: 0;
            padding-left: 16px;
        }
        
        .protocol-phase li {
            margin-bottom: 4px;
            color: #4a5568;
            font-size: 12px;
            line-height: 1.4;
        }
        
        /* Workout Frequency Styles */
        .workout-frequency-section {
            margin: 24px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .frequency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .frequency-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .frequency-item label {
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
        }
        
        .help-text {
            margin-top: 8px;
            color: #718096;
            font-size: 12px;
            font-style: italic;
        }
        
        /* Enhanced Calendar Styles */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .calendar-controls {
            display: flex;
            gap: 8px;
        }
        
        .calendar-grid.enhanced {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            margin: 16px 0;
        }
        
        .calendar-day {
            background: #f8fafc;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            min-height: 120px;
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .day-name {
            font-weight: 600;
            color: #2d3748 !important;
            font-size: 14px;
        }
        
        .add-workout-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4f46e5;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .add-workout-btn:hover {
            background: #3730a3;
            transform: scale(1.1);
        }
        
        .day-workouts {
            min-height: 80px;
        }
        
        .workout-item {
            background: #fff;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            transition: all 0.2s;
        }
        
        .workout-item:hover {
            border-color: #cbd5e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .workout-info {
            flex: 1;
        }
        
        .workout-type {
            font-weight: 600;
            color: #2d3748;
            font-size: 12px;
        }
        
        .workout-duration {
            color: #718096;
            font-size: 10px;
        }
        
        .workout-actions {
            display: flex;
            gap: 4px;
        }
        
        .workout-btn {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: none;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .edit-btn {
            background: #edf2f7;
            color: #4a5568;
        }
        
        .delete-btn {
            background: #fed7d7;
            color: #c53030;
        }
        
        .workout-btn:hover {
            transform: scale(1.1);
        }
        
        /* Workout Modal Styles */
        .workout-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            color: #2d3748;
            border-radius: 8px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            background: #4299e1;
            color: white;
            padding: 16px 24px;
            border-radius: 8px 8px 0 0;
            margin: -24px -24px 24px -24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: white;
            font-size: 20px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            color: #2d3748;
        }
        
        .modal-footer {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .workout-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        
        .workout-option {
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .workout-option:hover {
            border-color: #4f46e5;
            background: #f8fafc;
        }
        
        .workout-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }
        
        .workout-duration {
            color: #718096;
            font-size: 12px;
        }
        
        .checkin-metric {
            margin-bottom: 32px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .checkin-metric h3 {
            margin: 0 0 12px 0;
            color: #2d3748;
            font-size: 18px;
        }
        
        .checkin-metric p {
            margin: 0 0 16px 0;
            color: #718096;
            font-size: 14px;
        }
        
        .slider-container {
            margin: 16px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .slider-label span {
            font-weight: 600;
            color: #2d3748;
        }
        
        .slider-value {
            background: #4299e1;
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .slider-description {
            margin-top: 8px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-size: 14px;
            color: #4a5568;
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        
        .sleep-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 16px;
        }
        
        .sleep-hours-input {
            display: flex;
            flex-direction: column;
        }
        
        .sleep-hours-input input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
        }
        
        .readiness-summary {
            background: #ebf8ff;
            border: 1px solid #bee3f8;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }
        
        .readiness-score {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .readiness-score-value {
            font-size: 24px;
            font-weight: 700;
            color: #2b6cb0;
        }
        
        .readiness-score-label {
            color: #2d3748;
            font-weight: 600;
        }
        
        .coach-message {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            color: #2f855a;
            font-weight: 500;
        }
        
        .workout-adjustments {
            background: #fff5f5;
            border: 1px solid #feb2b2;
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            color: #742a2a;
        }
        
        .workout-adjustments h4 {
            margin: 0 0 8px 0;
            color: #742a2a;
        }
        
        /* Mobile-friendly touch targets */
        @media (max-width: 768px) {
            .slider {
                height: 12px;
            }
            
            .slider::-webkit-slider-thumb {
                width: 32px;
                height: 32px;
            }
            
            .slider::-moz-range-thumb {
                width: 32px;
                height: 32px;
            }
            
            .sleep-inputs {
                grid-template-columns: 1fr;
            }
            
            .checkin-metric {
                padding: 16px;
            }
        }
        
        /* Exercise Feedback Styles */
        .feedback-content, .alternatives-content {
            max-width: 600px;
            width: 95%;
        }
        
        .exercise-feedback-form {
            padding: 20px 0;
        }
        
        .feedback-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .feedback-option {
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .feedback-option:hover {
            border-color: #4299e1;
            background-color: #f7fafc;
        }
        
        .feedback-option.selected {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        
        .feedback-option h4 {
            margin: 0 0 8px 0;
            color: #2d3748;
        }
        
        .feedback-option p {
            margin: 0;
            color: #718096;
            font-size: 14px;
        }
        
        .feedback-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
        }
        
        /* Exercise Alternatives Styles */
        .alternatives-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .alternative-exercise {
            padding: 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f7fafc;
        }
        
        .alternative-exercise.selected {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        
        .alternative-exercise h4 {
            margin: 0 0 8px 0;
            color: #2d3748;
        }
        
        .alternative-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 12px 0;
        }
        
        .alternative-detail {
            text-align: center;
        }
        
        .alternative-detail-label {
            font-size: 12px;
            color: #718096;
            margin-bottom: 4px;
        }
        
        .alternative-detail-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .alternative-reason {
            font-size: 14px;
            color: #4a5568;
            font-style: italic;
        }
        
        /* Progression Display Styles */
        .progression-summary {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .progression-changes {
            background: #ebf8ff;
            border: 1px solid #bee3f8;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }
        
        .progression-change {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 4px 0;
        }
        
        .progression-change-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .progression-change-icon.increase {
            background: #68d391;
            color: white;
        }
        
        .progression-change-icon.decrease {
            background: #f6ad55;
            color: white;
        }
        
        .progression-change-icon.maintain {
            background: #a0aec0;
            color: white;
        }
        
        /* Exercise Rating Styles */
        .exercise-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 12px 0;
        }
        
        .rating-stars {
            display: flex;
            gap: 4px;
        }
        
        .rating-star {
            width: 24px;
            height: 24px;
            cursor: pointer;
            color: #e2e8f0;
            transition: color 0.2s ease;
        }
        
        .rating-star:hover,
        .rating-star.active {
            color: #f6ad55;
        }
        
        /* Time Optimization Styles */
        .time-optimization {
            background: #fff5f5;
            border: 1px solid #feb2b2;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .time-optimization h4 {
            margin: 0 0 8px 0;
            color: #742a2a;
        }
        
        .time-saved {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #2f855a;
            font-weight: 600;
        }
        
        /* Goals & Habits Styles */
        .goals-content, .habits-content, .create-goal-content {
            max-width: 800px;
            width: 95%;
        }
        
        .goal-card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            position: relative;
        }
        
        .goal-card.completed {
            background: #f0fff4;
            border-color: #9ae6b4;
        }
        
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .goal-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin: 0;
        }
        
        .goal-type {
            background: #4299e1;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .goal-progress {
            margin: 16px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #3182ce);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #718096;
        }
        
        .goal-milestones {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        
        .milestone {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
        }
        
        .milestone.achieved {
            background: #f0fff4;
            border-color: #9ae6b4;
        }
        
        .milestone-percentage {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .milestone-value {
            font-size: 14px;
            color: #718096;
        }
        
        .milestone-reward {
            font-size: 12px;
            color: #4a5568;
            margin-top: 4px;
        }
        
        /* Habit Tracking Styles */
        .habit-card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .streak-display {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 16px 0;
        }
        
        .streak-current {
            text-align: center;
        }
        
        .streak-number {
            font-size: 36px;
            font-weight: 700;
            color: #4299e1;
            line-height: 1;
        }
        
        .streak-label {
            font-size: 14px;
            color: #718096;
            margin-top: 4px;
        }
        
        .streak-details {
            flex: 1;
        }
        
        .streak-detail {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 14px;
        }
        
        .streak-detail-label {
            color: #718096;
        }
        
        .streak-detail-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .achievement {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        
        .achievement.unlocked {
            background: #f0fff4;
            border-color: #9ae6b4;
        }
        
        .achievement-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }
        
        .achievement-description {
            font-size: 12px;
            color: #718096;
        }
        
        .achievement-reward {
            font-size: 12px;
            color: #4a5568;
            margin-top: 8px;
            font-style: italic;
        }
        
        /* Motivational Toast Styles */
        .motivational-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.3s ease;
        }
        
        .motivational-toast.hidden {
            display: none;
        }
        
        .toast-content {
            display: flex;
            align-items: center;
            padding: 16px;
            gap: 12px;
        }
        
        .toast-icon {
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .toast-message {
            flex: 1;
            font-size: 14px;
            color: #2d3748;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            color: #718096;
            cursor: pointer;
            padding: 4px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Create Goal Form Styles */
        .create-goal-form {
            padding: 20px 0;
        }
        
        .goal-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .goal-type-option {
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .goal-type-option:hover {
            border-color: #4299e1;
            background-color: #f7fafc;
        }
        
        .goal-type-option.selected {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        
        .goal-type-option h4 {
            margin: 0 0 8px 0;
            color: #2d3748;
        }
        
        .goal-type-option p {
            margin: 0;
            color: #718096;
            font-size: 14px;
        }
        
        .goal-form-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 14px;
            font-weight: 500;
            color: #2d3748;
            margin-bottom: 4px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        /* Load Management Styles */
        .load-management-content, .strava-import-content {
            max-width: 900px;
            width: 95%;
        }
        
        .load-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .load-metric {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        
        .load-metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 4px;
        }
        
        .load-metric-label {
            font-size: 14px;
            color: #718096;
            margin-bottom: 8px;
        }
        
        .load-metric-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .load-metric-status.low {
            background: #f0fff4;
            color: #2f855a;
        }
        
        .load-metric-status.medium {
            background: #fff5f5;
            color: #c53030;
        }
        
        .load-metric-status.high {
            background: #fed7d7;
            color: #9b2c2c;
        }
        
        .recovery-status {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .recovery-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .recovery-status-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .recovery-status-level {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .recovery-status-level.excellent {
            background: #f0fff4;
            color: #2f855a;
        }
        
        .recovery-status-level.good {
            background: #ebf8ff;
            color: #3182ce;
        }
        
        .recovery-status-level.moderate {
            background: #fff5f5;
            color: #c53030;
        }
        
        .recovery-status-level.poor {
            background: #fed7d7;
            color: #9b2c2c;
        }
        
        .recovery-debt {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
        }
        
        .recovery-debt-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .recovery-debt-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #3182ce);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .recovery-debt-text {
            font-size: 14px;
            color: #718096;
            min-width: 80px;
        }
        
        .activity-list {
            margin: 20px 0;
        }
        
        .activity-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .activity-info {
            flex: 1;
        }
        
        .activity-name {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }
        
        .activity-details {
            font-size: 14px;
            color: #718096;
        }
        
        .activity-metrics {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .activity-metric {
            text-align: center;
        }
        
        .activity-metric-value {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .activity-metric-label {
            font-size: 12px;
            color: #718096;
        }
        
        .risk-assessment {
            background: #fff5f5;
            border: 1px solid #feb2b2;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .risk-assessment.high {
            background: #fed7d7;
            border-color: #fc8181;
        }
        
        .risk-assessment.medium {
            background: #fff5f5;
            border-color: #feb2b2;
        }
        
        .risk-assessment.low {
            background: #f0fff4;
            border-color: #9ae6b4;
        }
        
        .risk-factors {
            margin: 8px 0;
        }
        
        .risk-factor {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 4px 0;
            font-size: 14px;
        }
        
        .risk-factor-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .risk-factor-icon.high {
            background: #fc8181;
            color: white;
        }
        
        .risk-factor-icon.medium {
            background: #feb2b2;
            color: white;
        }
        
        .risk-factor-icon.low {
            background: #9ae6b4;
            color: white;
        }
        
        .strava-import-form {
            padding: 20px 0;
        }
        
        .import-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .import-option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .import-option:hover {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        
        .import-option.selected {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        
        .import-option h4 {
            margin: 0 0 8px 0;
            color: #2d3748;
        }
        
        .import-option p {
            margin: 0;
            color: #718096;
            font-size: 14px;
        }
        
        .import-progress {
            margin: 20px 0;
            padding: 16px;
            background: #f7fafc;
            border-radius: 8px;
            display: none;
        }
        
        .import-progress.show {
            display: block;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #3182ce);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 14px;
            color: #718096;
            text-align: center;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .dashboard-controls {
                flex-direction: column;
            }
            
            .feedback-options {
                grid-template-columns: 1fr;
            }
            
            .alternative-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
    
    <!-- Skip to main content link for screen readers -->
    <style>
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #4f46e5;
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
            font-weight: bold;
        }
        .skip-link:focus {
            top: 6px;
        }
        
        /* Skip Links */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #000000;
            color: #ffffff;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
            font-weight: bold;
        }
        
        .skip-link:focus {
            top: 6px;
        }
        
        /* Semantic HTML Structure */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .app-header {
            order: 1;
        }
        
        .app-content {
            order: 2;
            flex: 1;
        }
        
        .bottom-navigation {
            order: 3;
        }
        
        .app-footer {
            order: 4;
        }
        
        /* Ensure proper heading hierarchy */
        h1, h2, h3, h4, h5, h6 {
            margin-top: 0;
            margin-bottom: 0.5em;
        }
        
        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#navigation" class="skip-link">Skip to navigation</a>
    
    <!-- Main App Container for SPA -->
    <div class="app-container">
        <!-- Header with Navigation -->
        <header id="app-header" class="app-header" role="banner">
            <nav id="navigation" class="main-navigation" role="navigation" aria-label="Main navigation">
                <!-- Navigation content will be loaded here -->
            </nav>
        </header>
        
        <!-- Main Content Area -->
        <main id="main-content" class="app-content" role="main">
            <!-- Dynamic content will be loaded here by Router -->
            <div class="loading-state">
                <div class="loading-spinner" aria-hidden="true"></div>
                <p>Loading IgniteFitness...</p>
            </div>
        </main>
        
        <!-- Bottom Navigation -->
        <nav id="bottom-navigation" class="bottom-navigation" role="navigation" aria-label="Bottom navigation">
            <!-- Bottom navigation will be loaded here -->
        </nav>
        
        <!-- Footer -->
        <footer id="app-footer" class="app-footer" role="contentinfo">
            <!-- Footer content will be loaded here -->
        </footer>
    </div>

    <!-- Legacy content (to be migrated) -->
    <div style="display: none;">
        <!-- Login Form -->
            <section id="loginForm" class="form-section" aria-labelledby="login-heading">
                <h2 id="login-heading">Welcome Back</h2>
                <form role="form" aria-label="User login form" onsubmit="login(); return false;">
                    <div class="form-group">
                        <label for="loginUsername">Username</label>
                        <input type="text" 
                               id="loginUsername" 
                               name="username"
                               class="form-input" 
                               placeholder="Enter username"
                               aria-required="true"
                               autocomplete="username"
                               aria-describedby="username-help">
                        <div id="username-help" class="sr-only">Enter your username to access your account</div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" 
                               id="loginPassword" 
                               name="password"
                               class="form-input" 
                               placeholder="Enter password"
                               aria-required="true"
                               autocomplete="current-password"
                               aria-describedby="password-help">
                        <div id="password-help" class="sr-only">Enter your password to access your account</div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" 
                                class="btn" 
                                aria-describedby="login-help">
                            Login
                        </button>
                        <button type="button" 
                                class="btn btn-secondary" 
                                onclick="showRegisterForm()"
                                aria-describedby="register-help">
                            Register New Athlete
                        </button>
                    </div>
                    <div id="login-help" class="sr-only">Click to log into your IgniteFitness account</div>
                    <div id="register-help" class="sr-only">Click to create a new athlete account</div>
                </form>
                <div class="form-footer" style="text-align: center; margin-top: 15px;">
                    <a href="#" 
                       onclick="showPasswordReset(); return false;" 
                       style="color: #68d391; text-decoration: none;"
                       aria-label="Reset your password">
                        Forgot Password?
                    </a>
                </div>
                <div id="loginError" 
                     role="alert" 
                     aria-live="polite"
                     style="color: #fc8181; margin-top: 10px; display: none;">
                </div>
            </section>

            <!-- Register Form -->
            <section id="registerForm" class="form-section hidden" aria-labelledby="register-heading">
                <h2 id="register-heading">Register New Athlete</h2>
                <form role="form" aria-label="Athlete registration form" onsubmit="register(); return false;">
                    <div class="form-group">
                        <label for="regUsername">Username</label>
                        <input type="text" 
                               id="regUsername" 
                               name="username"
                               class="form-input" 
                               placeholder="Choose username"
                               aria-required="true"
                               autocomplete="username"
                               aria-describedby="reg-username-help">
                        <div id="reg-username-help" class="sr-only">Choose a unique username for your account</div>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Password</label>
                        <input type="password" 
                               id="regPassword" 
                               name="password"
                               class="form-input" 
                               placeholder="Choose password"
                               aria-required="true"
                               autocomplete="new-password"
                               aria-describedby="reg-password-help">
                        <div id="reg-password-help" class="sr-only">Choose a secure password for your account</div>
                    </div>
                    <div class="form-group">
                        <label for="regConfirmPassword">Confirm Password</label>
                        <input type="password" 
                               id="regConfirmPassword" 
                               name="confirmPassword"
                               class="form-input" 
                               placeholder="Confirm password"
                               aria-required="true"
                               autocomplete="new-password"
                               aria-describedby="reg-confirm-help">
                        <div id="reg-confirm-help" class="sr-only">Re-enter your password to confirm</div>
                    </div>
                    <div class="form-group">
                        <label for="regAthleteName">Athlete Name</label>
                        <input type="text" 
                               id="regAthleteName" 
                               name="athleteName"
                               class="form-input" 
                               placeholder="Full name"
                               aria-required="true"
                               autocomplete="name"
                               aria-describedby="reg-name-help">
                        <div id="reg-name-help" class="sr-only">Enter your full name as an athlete</div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" 
                                class="btn" 
                                aria-describedby="register-help">
                            Register Athlete
                        </button>
                        <button type="button" 
                                class="btn btn-secondary" 
                                onclick="hideRegisterForm()"
                                aria-describedby="cancel-help">
                            Cancel
                        </button>
                    </div>
                    <div id="register-help" class="sr-only">Click to create your new athlete account</div>
                    <div id="cancel-help" class="sr-only">Click to cancel registration and return to login</div>
                </form>
                <div id="registerError" 
                     role="alert" 
                     aria-live="polite"
                     style="color: #fc8181; margin-top: 10px; display: none;">
                </div>
            </section>

        <!-- Password Reset Form -->
        <div id="passwordResetForm" class="form-section hidden">
            <h2>Reset Password</h2>
            <div class="form-group">
                <label for="resetUsername">Username</label>
                <input type="text" id="resetUsername" class="form-input" placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label for="resetAthleteName">Athlete Name</label>
                <input type="text" id="resetAthleteName" class="form-input" placeholder="Enter your athlete name">
            </div>
            <div class="form-group">
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
            </div>
            <div class="form-group">
                <label for="confirmNewPassword">Confirm New Password</label>
                <input type="password" id="confirmNewPassword" class="form-input" placeholder="Confirm new password">
            </div>
            <button class="btn" onclick="resetPassword()">Reset Password</button>
            <button class="btn" onclick="hidePasswordReset()" style="background: #718096; margin-left: 10px;">Cancel</button>
            <div id="resetError" style="color: #fc8181; margin-top: 10px; display: none;"></div>
        </div>

        <!-- Onboarding Modal -->
        <div id="onboardingModal" class="modal hidden">
            <div class="modal-content onboarding-content">
                <div class="modal-header">
                    <h2>Welcome to Ignite Fitness!</h2>
                    <p>Let's personalize your experience with a few quick questions.</p>
                </div>
                <div class="modal-body">
                    <div id="onboardingContainer">
                        <!-- Onboarding content will be dynamically loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="skipOnboardingBtn" class="btn secondary" onclick="skipOnboarding()">Skip for now</button>
                    <div class="onboarding-progress">
                        <span id="onboardingStep">1</span> of <span id="onboardingTotal">6</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Dashboard -->
        <div id="userDashboard" class="hidden">
            <div class="form-section">
                <h3>Welcome, <span id="currentAthleteName"></span></h3>
                <p>Your AI-powered training platform is ready!</p>
                <div class="dashboard-controls">
                    <button class="btn" onclick="logout()">Logout</button>
                    <button class="btn secondary" onclick="showPreferences()">Preferences</button>
                    <button class="btn secondary" onclick="toggleRole()">Switch Role</button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('personalData', this)">Personal Data</button>
                    <button class="tab-btn" onclick="showTab('goals', this)">Goals</button>
                    <button class="tab-btn" onclick="showTab('workoutPlan', this)">Workout Plan</button>
                    <button class="tab-btn" onclick="showTab('logWorkout', this)">Log Workout</button>
                    <button class="tab-btn" onclick="showTab('soccer', this)">Soccer</button>
                    <button class="tab-btn" onclick="showTab('devices', this)">Devices</button>
                </div>

                <!-- Status Indicators -->
                <div class="status-indicators">
                    <!-- Seasonal Phase Indicator -->
                    <div id="seasonalPhaseIndicator" class="seasonal-phase-indicator">
                        <div class="phase-info">
                            <span id="currentPhaseName">Off-Season</span>
                            <span id="phaseProgress">0%</span>
                        </div>
                        <button onclick="showPhaseModal()" class="phase-details-btn">View Details</button>
                    </div>
                    
                    <!-- Sync Status Indicator -->
                    <div id="syncStatusIndicator" class="sync-status-indicator">
                        <div class="sync-info">
                            <span id="syncStatus">🔄 Syncing...</span>
                            <span id="lastSync">Last sync: Never</span>
                        </div>
                        <button onclick="manualSync()" class="sync-btn">Sync Now</button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content" id="personalData">
                    <h3>Personal Information</h3>
                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" id="age" class="form-input" placeholder="Enter your age">
                    </div>
                    <div class="form-group">
                        <label for="weight">Weight (kg)</label>
                        <input type="number" id="weight" class="form-input" placeholder="Enter your weight">
                    </div>
                    <div class="form-group">
                        <label for="height">Height</label>
                        <div class="height-input-group">
                            <input type="number" id="height" class="form-input" placeholder="Enter your height">
                            <select id="heightUnit" class="form-input height-unit">
                                <option value="cm">cm</option>
                                <option value="ft">ft & in</option>
                            </select>
                        </div>
                        <div id="heightFeetInches" class="height-feet-inches" style="display: none;">
                            <input type="number" id="heightFeet" class="form-input" placeholder="Feet" min="3" max="8">
                            <input type="number" id="heightInches" class="form-input" placeholder="Inches" min="0" max="11">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="experience">Training Experience</label>
                        <select id="experience" class="form-input">
                            <option value="">Select experience level</option>
                            <option value="newcomer">Newcomer (0-6 months)</option>
                            <option value="novice">Novice (6 months - 2 years)</option>
                            <option value="intermediate">Intermediate (2-5 years)</option>
                            <option value="advanced">Advanced (5+ years)</option>
                            <option value="elite">Elite (Competitive level)</option>
                        </select>
                    </div>
                    
                    <!-- Sport-Specific Training Section -->
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="sportSpecific" onchange="toggleSportSpecific()">
                            Sport-Specific Training
                        </label>
                    </div>
                    
                    <div id="sportSpecificOptions" class="sport-specific-options" style="display: none;">
                        <div class="form-group">
                            <label for="sport">Sport</label>
                            <select id="sport" class="form-input" onchange="updateInjuryPrevention()">
                                <option value="">Select sport</option>
                                <option value="soccer">Soccer</option>
                                <option value="basketball">Basketball</option>
                                <option value="tennis">Tennis</option>
                                <option value="running">Running</option>
                                <option value="cycling">Cycling</option>
                                <option value="swimming">Swimming</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="seasonPhase">Season Phase</label>
                            <select id="seasonPhase" class="form-input">
                                <option value="">Select phase</option>
                                <option value="off">Off-Season</option>
                                <option value="pre">Pre-Season</option>
                                <option value="mid">Mid-Season</option>
                                <option value="playoffs">Playoffs</option>
                                <option value="post">Post-Season</option>
                            </select>
                        </div>
                        
                        <!-- Injury Prevention Section -->
                        <div class="injury-prevention-section">
                            <h4>Injury Prevention Focus</h4>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="injuryPrevention" onchange="toggleInjuryPrevention()">
                                    Include Sport-Specific Injury Prevention
                                </label>
                            </div>
                            
                            <div id="injuryPreventionOptions" class="injury-prevention-options" style="display: none;">
                                <div class="form-group">
                                    <label>Previous Injuries (Select All That Apply)</label>
                                    <div class="checkbox-group">
                                        <label class="injury-option"><input type="checkbox" name="previousInjuries" value="acl"> ACL Tear/Injury</label>
                                        <label class="injury-option"><input type="checkbox" name="previousInjuries" value="ankle"> Ankle Sprains</label>
                                        <label class="injury-option"><input type="checkbox" name="previousInjuries" value="knee"> Other Knee Injuries</label>
                                        <label class="injury-option"><input type="checkbox" name="previousInjuries" value="hamstring"> Hamstring Strains</label>
                                        <label class="injury-option"><input type="checkbox" name="previousInjuries" value="shoulder"> Shoulder Issues</label>
                                        <label class="injury-option"><input type="checkbox" name="previousInjuries" value="back"> Back Problems</label>
                                        <label class="injury-option"><input type="checkbox" name="previousInjuries" value="none"> No Previous Injuries</label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Injury Risk Level</label>
                                    <select id="injuryRiskLevel" class="form-input">
                                        <option value="low">Low Risk</option>
                                        <option value="medium">Medium Risk</option>
                                        <option value="high">High Risk</option>
                                    </select>
                                </div>
                                
                                <div id="injuryPreventionRecommendations" class="injury-recommendations"></div>
                                
                                <!-- ACL Prevention Special Section -->
                                <div id="aclPreventionSection" class="acl-prevention-section" style="display: none;">
                                    <h5>ACL Prevention Protocol</h5>
                                    <div class="acl-protocol">
                                        <div class="protocol-phase">
                                            <h6>Phase 1: Foundation (Weeks 1-2)</h6>
                                            <ul>
                                                <li>Single-leg balance: 30 seconds each leg</li>
                                                <li>Wall sits: 3 sets of 30 seconds</li>
                                                <li>Clamshells: 3 sets of 15 each side</li>
                                                <li>Glute bridges: 3 sets of 15</li>
                                            </ul>
                                        </div>
                                        <div class="protocol-phase">
                                            <h6>Phase 2: Strength (Weeks 3-4)</h6>
                                            <ul>
                                                <li>Single-leg squats: 3 sets of 8 each leg</li>
                                                <li>Lateral lunges: 3 sets of 10 each side</li>
                                                <li>Nordic hamstring curls: 3 sets of 8</li>
                                                <li>Single-leg RDL: 3 sets of 8 each leg</li>
                                            </ul>
                                        </div>
                                        <div class="protocol-phase">
                                            <h6>Phase 3: Plyometrics (Weeks 5-6)</h6>
                                            <ul>
                                                <li>Jump landing mechanics: 3 sets of 8</li>
                                                <li>Lateral bounds: 3 sets of 6 each direction</li>
                                                <li>Single-leg hops: 3 sets of 8 each leg</li>
                                                <li>Agility ladder drills: 10 minutes</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="savePersonalInfo()">Save Personal Info</button>
                    <div id="personalDataStatus" class="save-status"></div>
                </div>

                <div class="tab-content hidden" id="goals">
                    <h3>Training Goals & Preferences</h3>
                    
                    <!-- Primary Goals Section -->
                    <div class="form-group">
                        <label class="goals-label">Primary Training Goals (Select All That Apply)</label>
                        <div class="checkbox-group">
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="soccer_performance"> Soccer Performance</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="weight_training"> Weight Training</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="strength"> General Strength</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="endurance"> Endurance</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="speed"> Speed & Agility</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="muscle_gain"> Muscle Gain</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="fat_loss"> Fat Loss</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="injury_prevention"> Injury Prevention</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="flexibility"> Flexibility</label>
                            <label class="goal-option"><input type="checkbox" name="trainingGoals" value="recovery"> Recovery & Wellness</label>
                        </div>
                    </div>
                    
                    <!-- Workout Frequency Preferences -->
                    <div class="workout-frequency-section">
                        <h4>Workout Frequency Preferences</h4>
                        <div class="frequency-grid">
                            <div class="frequency-item">
                                <label>Weight Training (days/week)</label>
                                <select id="weightTrainingDays" class="form-input">
                                    <option value="0">0 days</option>
                                    <option value="1">1 day</option>
                                    <option value="2">2 days</option>
                                    <option value="3" selected>3 days</option>
                                    <option value="4">4 days</option>
                                    <option value="5">5 days</option>
                                    <option value="6">6 days</option>
                                </select>
                            </div>
                            <div class="frequency-item">
                                <label>Soccer Activities (games + practice per week)</label>
                                <select id="soccerTrainingDays" class="form-input">
                                    <option value="0">0 days</option>
                                    <option value="1">1 day</option>
                                    <option value="2" selected>2 days</option>
                                    <option value="3">3 days</option>
                                    <option value="4">4 days</option>
                                    <option value="5">5 days</option>
                                    <option value="6">6 days</option>
                                </select>
                                <small style="color: #718096; font-size: 12px; display: block; margin-top: 4px;">Will be split between indoor/outdoor games and practice</small>
                            </div>
                            <div class="frequency-item">
                                <label>Cardio (days/week)</label>
                                <select id="cardioDays" class="form-input">
                                    <option value="0">0 days</option>
                                    <option value="1">1 day</option>
                                    <option value="2">2 days</option>
                                    <option value="3" selected>3 days</option>
                                    <option value="4">4 days</option>
                                    <option value="5">5 days</option>
                                    <option value="6">6 days</option>
                                </select>
                            </div>
                            <div class="frequency-item">
                                <label>Recovery/Mobility (days/week)</label>
                                <select id="recoveryDays" class="form-input">
                                    <option value="0">0 days</option>
                                    <option value="1">1 day</option>
                                    <option value="2" selected>2 days</option>
                                    <option value="3">3 days</option>
                                    <option value="4">4 days</option>
                                    <option value="5">5 days</option>
                                    <option value="6">6 days</option>
                                </select>
                            </div>
                            <div class="frequency-item">
                                <label>Yoga (days/week)</label>
                                <select id="yogaDays" class="form-input">
                                    <option value="0">0 days</option>
                                    <option value="1">1 day</option>
                                    <option value="2">2 days</option>
                                    <option value="3">3 days</option>
                                    <option value="4">4 days</option>
                                    <option value="5">5 days</option>
                                    <option value="6">6 days</option>
                                    <option value="7" selected>7 days (Daily)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Auto-Assignment Option -->
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="autoAssignWorkouts" onchange="toggleAutoAssignment()">
                            Automatically assign workouts based on my preferences
                        </label>
                        <p class="help-text">If checked, the system will automatically schedule your workouts based on your frequency preferences and available days.</p>
                    </div>
                    
                    <button class="btn" onclick="saveGoals()">Save Goals & Preferences</button>
                    <div id="goalsStatus" class="save-status"></div>
                </div>

                <div class="tab-content hidden" id="workoutPlan">
                    <h3>Workout Planning & Calendar</h3>
                    
                    <!-- Injury Prevention Tab -->
                    <div class="injury-prevention-tab">
                        <h4>Sport-Specific Injury Prevention</h4>
                        <div class="injury-prevention-content">
                            <div class="form-group">
                                <label for="preventionFocus">Prevention Focus</label>
                                <select id="preventionFocus" class="form-input" onchange="updatePreventionExercises()">
                                    <option value="">Select focus area</option>
                                    <option value="acl_prevention">ACL Prevention (Soccer)</option>
                                    <option value="ankle_stability">Ankle Stability</option>
                                    <option value="knee_strength">Knee Strength</option>
                                    <option value="hamstring_flexibility">Hamstring Flexibility</option>
                                    <option value="shoulder_mobility">Shoulder Mobility</option>
                                    <option value="core_stability">Core Stability</option>
                                    <option value="balance_training">Balance Training</option>
                                </select>
                            </div>
                            
                            <div id="preventionExercises" class="prevention-exercises">
                                <h5>Recommended Prevention Exercises</h5>
                                <div id="exerciseList" class="exercise-list"></div>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="includePrevention" onchange="togglePreventionInWorkout()">
                                    Include Prevention Exercises in Workout Plans
                                </label>
                            </div>
                            
                            <button class="btn" onclick="saveInjuryPrevention()">Save Prevention Settings</button>
                            <div id="preventionStatus" class="save-status"></div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Workout Calendar -->
                    <div class="workout-calendar-section">
                        <div class="calendar-header">
                            <h4>Weekly Workout Schedule</h4>
                            <div class="calendar-controls">
                                <button class="btn secondary" onclick="autoAssignWorkouts()">Auto-Assign</button>
                                <button class="btn secondary" onclick="clearSchedule()">Clear All</button>
                                <button class="btn" onclick="saveWorkoutCalendar()">Save Schedule</button>
                            </div>
                        </div>
                        
                        <div class="calendar-grid enhanced">
                            <div class="calendar-day" data-day="monday">
                                <div class="day-header">
                                    <span class="day-name">Monday</span>
                                    <button class="add-workout-btn" onclick="addWorkout('monday')" title="Add Workout">+</button>
                                </div>
                                <div class="day-workouts" id="monday-workouts">
                                    <!-- Workouts will be added here -->
                                </div>
                            </div>
                            <div class="calendar-day" data-day="tuesday">
                                <div class="day-header">
                                    <span class="day-name">Tuesday</span>
                                    <button class="add-workout-btn" onclick="addWorkout('tuesday')" title="Add Workout">+</button>
                                </div>
                                <div class="day-workouts" id="tuesday-workouts">
                                    <!-- Workouts will be added here -->
                                </div>
                            </div>
                            <div class="calendar-day" data-day="wednesday">
                                <div class="day-header">
                                    <span class="day-name">Wednesday</span>
                                    <button class="add-workout-btn" onclick="addWorkout('wednesday')" title="Add Workout">+</button>
                                </div>
                                <div class="day-workouts" id="wednesday-workouts">
                                    <!-- Workouts will be added here -->
                                </div>
                            </div>
                            <div class="calendar-day" data-day="thursday">
                                <div class="day-header">
                                    <span class="day-name">Thursday</span>
                                    <button class="add-workout-btn" onclick="addWorkout('thursday')" title="Add Workout">+</button>
                                </div>
                                <div class="day-workouts" id="thursday-workouts">
                                    <!-- Workouts will be added here -->
                                </div>
                            </div>
                            <div class="calendar-day" data-day="friday">
                                <div class="day-header">
                                    <span class="day-name">Friday</span>
                                    <button class="add-workout-btn" onclick="addWorkout('friday')" title="Add Workout">+</button>
                                </div>
                                <div class="day-workouts" id="friday-workouts">
                                    <!-- Workouts will be added here -->
                                </div>
                            </div>
                            <div class="calendar-day" data-day="saturday">
                                <div class="day-header">
                                    <span class="day-name">Saturday</span>
                                    <button class="add-workout-btn" onclick="addWorkout('saturday')" title="Add Workout">+</button>
                                </div>
                                <div class="day-workouts" id="saturday-workouts">
                                    <!-- Workouts will be added here -->
                                </div>
                            </div>
                            <div class="calendar-day" data-day="sunday">
                                <div class="day-header">
                                    <span class="day-name">Sunday</span>
                                    <button class="add-workout-btn" onclick="addWorkout('sunday')" title="Add Workout">+</button>
                                </div>
                                <div class="day-workouts" id="sunday-workouts">
                                    <!-- Workouts will be added here -->
                                </div>
                            </div>
                        </div>
                        
                        <div id="calendarStatus" class="save-status"></div>
                    </div>
                    
                    <!-- Workout Plan Controls -->
                    <div class="workout-controls">
                        <h4>Generate Workout Plan</h4>
                        <div class="form-group">
                            <label for="sessionType">Session Type</label>
                            <select id="sessionType" class="form-input">
                                <option value="Upper Body">Upper Body</option>
                                <option value="Lower Body">Lower Body</option>
                                <option value="Full Body">Full Body</option>
                                <option value="Cardio">Cardio</option>
                                <option value="Soccer Training">Soccer Training</option>
                                <option value="Core">Core</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="workoutDuration">Duration (minutes)</label>
                            <input type="number" id="workoutDuration" class="form-input" value="60" min="15" max="180">
                        </div>
                        
                        <button class="btn" onclick="generateWorkoutPlan()">Generate Workout Plan</button>
                        <button class="btn secondary" onclick="analyzeUserPatterns()">Analyze Patterns</button>
                    </div>
                    
                    <div id="workoutPlanDisplay"></div>
                    
                    <!-- Pattern Insights Section -->
                    <div id="patternInsights" class="pattern-insights-section" style="display: none;">
                        <h3>📊 Training Insights</h3>
                        <div id="insightsContent"></div>
                    </div>
                </div>

                <div class="tab-content hidden" id="logWorkout">
                    <h3>Log Workout</h3>
                    <p>Track your workouts and monitor progress.</p>
                    
                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="btn" onclick="startWorkout()">Start Workout</button>
                        <button class="btn secondary" onclick="logQuickWorkout()">Quick Log</button>
                        <button class="btn secondary" onclick="viewProgress()">View Progress</button>
                    </div>
                    
                    <!-- Progress Charts Section -->
                    <div class="progress-section">
                        <h4>📈 Progress Overview</h4>
                        <div class="charts-container">
                            <div class="chart-card">
                                <h5>Strength Progress</h5>
                                <div id="strengthChart" class="chart-placeholder">
                                    <p>Chart will appear here</p>
                                </div>
                            </div>
                            
                            <div class="chart-card">
                                <h5>Volume Trend</h5>
                                <div id="volumeChart" class="chart-placeholder">
                                    <p>Chart will appear here</p>
                                </div>
                            </div>
                            
                            <div class="chart-card">
                                <h5>Consistency</h5>
                                <div id="consistencyChart" class="chart-placeholder">
                                    <p>Chart will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Workouts -->
                    <div class="recent-workouts">
                        <h4>Recent Workouts</h4>
                        <div id="recentWorkoutsList" class="workouts-list">
                            <p>No recent workouts found. Start your first workout!</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content hidden" id="soccer">
                    <h3>Soccer Training</h3>
                    <p>Soccer-specific training features will be available here.</p>
                </div>

                <div class="tab-content hidden" id="devices">
                    <h3>Device Integration</h3>
                    <p>Connect your wearable devices and data sources.</p>
                    
                    <!-- Strava Integration -->
                    <div class="device-section">
                        <h4>🏃‍♂️ Strava Integration</h4>
                        <div id="stravaStatus" class="device-status">
                            <p>Checking Strava connection...</p>
                        </div>
                        <div class="device-actions">
                            <button id="stravaConnectBtn" onclick="connectToStrava()" class="btn" style="display: none;">
                                Connect to Strava
                            </button>
                            <button id="stravaDisconnectBtn" onclick="disconnectFromStrava()" class="btn secondary" style="display: none;">
                                Disconnect from Strava
                            </button>
                            <button id="stravaSyncBtn" onclick="syncStravaData()" class="btn" style="display: none;">
                                Sync Activities
                            </button>
                        </div>
                    </div>
                    
                    <!-- Other Devices -->
                    <div class="device-section">
                        <h4>📱 Other Devices</h4>
                        <p>Additional device integrations coming soon...</p>
                    </div>
                </div>
            </div>
        </div>
        </main>
    </div>

    <!-- AI Coach Chat Interface -->
    <div id="aiChatContainer" class="ai-chat-container hidden">
        <div class="ai-chat-header">
            <h3>🤖 AI Coach</h3>
            <button onclick="toggleAIChat()" class="ai-chat-close">×</button>
        </div>
        <div id="aiChatMessages" class="ai-chat-messages"></div>
        <div class="ai-chat-input-container">
            <input type="text" id="aiChatInput" placeholder="Ask your AI coach anything..." class="ai-chat-input">
            <button onclick="sendToAI()" class="ai-chat-send">Send</button>
        </div>
        <div class="ai-chat-quick-actions">
            <button onclick="quickAction('injury')" class="ai-quick-btn">Injury Help</button>
            <button onclick="quickAction('fatigue')" class="ai-quick-btn">Fatigue</button>
            <button onclick="quickAction('goals')" class="ai-quick-btn">Goal Change</button>
            <button onclick="quickAction('schedule')" class="ai-quick-btn">Schedule</button>
        </div>
    </div>

    <!-- Seasonal Phase Modal -->
    <div id="phaseModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="phaseModalTitle">Training Phase Details</h3>
                <button onclick="closePhaseModal()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="phaseDetails"></div>
                <div class="phase-actions">
                    <button onclick="changePhase()" class="btn">Change Phase</button>
                    <button onclick="addGame()" class="btn">Add Game</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Check-in Modal -->
    <div id="dailyCheckInModal" class="modal hidden">
        <div class="modal-content checkin-content">
            <div class="modal-header">
                <h2>Daily Readiness Check</h2>
                <p>Let's assess how you're feeling today to optimize your workout</p>
            </div>
            <div class="modal-body">
                <div id="checkInContainer">
                    <!-- Check-in content will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="skipCheckInBtn" class="btn secondary" onclick="skipDailyCheckIn()">Skip for today</button>
                <button id="completeCheckInBtn" class="btn primary" onclick="completeDailyCheckIn()" disabled>Complete Check-in</button>
            </div>
        </div>
    </div>

    <!-- Preferences Modal -->
    <div id="preferencesModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚙️ App Preferences</h3>
                <button onclick="closePreferences()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div style="background: #eef2ff; border-left: 4px solid #4299e1; padding: 12px; margin-bottom: 24px; border-radius: 4px;">
                    <strong style="color: #1e40af;">💡 Quick Tip:</strong>
                    <p style="margin: 8px 0 0 0; color: #1e40af; font-size: 14px;">
                        To set your goals and weekly schedule, go to the <strong>"Goals"</strong> and <strong>"Workout Plan"</strong> tabs in the main app!
                    </p>
                </div>
                
                <div class="preferences-section">
                    <h4>📊 Dashboard Display</h4>
                    <p style="color: #4a5568; font-size: 14px; margin-bottom: 12px;">Choose how much data you want to see on your dashboard:</p>
                    <div class="radio-group">
                        <label><input type="radio" name="dataPreference" value="basics"> <span>Basics - Simple metrics only</span></label>
                        <label><input type="radio" name="dataPreference" value="some_metrics"> <span>Some Metrics - Progress charts and weekly load</span></label>
                        <label><input type="radio" name="dataPreference" value="all_data"> <span>All Data - Detailed analytics and periodization</span></label>
                    </div>
                </div>
                
                <div class="preferences-section">
                    <h4>👤 Your Role</h4>
                    <p style="color: #4a5568; font-size: 14px; margin-bottom: 12px;">How are you using this app?</p>
                    <div class="radio-group">
                        <label><input type="radio" name="userRole" value="athlete"> <span>Athlete - Training for personal goals</span></label>
                        <label><input type="radio" name="userRole" value="coach"> <span>Coach - Training athletes and clients</span></label>
                    </div>
                </div>
                
                <div class="preferences-section">
                    <h4>🎯 Primary Training Focus</h4>
                    <p style="color: #4a5568; font-size: 14px; margin-bottom: 12px;">What's your main training goal?</p>
                    <div class="form-group">
                        <select id="primaryGoalPref" class="form-input">
                            <option value="strength">💪 Strength & Power</option>
                            <option value="sport_performance">⚽ Sport Performance</option>
                            <option value="general_fitness">🏃 General Fitness</option>
                            <option value="endurance">🏃‍♀️ Endurance</option>
                            <option value="weight_loss">⚖️ Weight Loss</option>
                        </select>
                    </div>
                </div>
                
                <div style="background: #fff5e1; border-left: 4px solid #f59e0b; padding: 12px; margin-top: 24px; border-radius: 4px;">
                    <strong style="color: #92400e;">📅 Don't Forget:</strong>
                    <p style="margin: 8px 0 0 0; color: #92400e; font-size: 14px;">
                        After saving preferences, go to <strong>"Goals"</strong> tab to set your training goals, and <strong>"Workout Plan"</strong> to create your weekly schedule!
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closePreferences()">Cancel</button>
                <button class="btn" onclick="savePreferences()">💾 Save Preferences</button>
            </div>
        </div>
    </div>

    <!-- Exercise Feedback Modal -->
    <div id="exerciseFeedbackModal" class="modal hidden">
        <div class="modal-content feedback-content">
            <div class="modal-header">
                <h3>Exercise Feedback</h3>
                <button onclick="closeExerciseFeedback()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="exerciseFeedbackContainer">
                    <!-- Exercise feedback content will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeExerciseFeedback()">Cancel</button>
                <button class="btn primary" onclick="submitExerciseFeedback()">Submit Feedback</button>
            </div>
        </div>
    </div>

    <!-- Exercise Alternatives Modal -->
    <div id="exerciseAlternativesModal" class="modal hidden">
        <div class="modal-content alternatives-content">
            <div class="modal-header">
                <h3>Exercise Alternatives</h3>
                <button onclick="closeExerciseAlternatives()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="exerciseAlternativesContainer">
                    <!-- Exercise alternatives content will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeExerciseAlternatives()">Keep Original</button>
                <button class="btn primary" onclick="selectExerciseAlternative()">Use Alternative</button>
            </div>
        </div>
    </div>

    <!-- Goals Modal -->
    <div id="goalsModal" class="modal hidden">
        <div class="modal-content goals-content">
            <div class="modal-header">
                <h3>My Goals</h3>
                <button onclick="closeGoalsModal()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="goalsContainer">
                    <!-- Goals content will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeGoalsModal()">Close</button>
                <button class="btn primary" onclick="showCreateGoalModal()">Set New Goal</button>
            </div>
        </div>
    </div>

    <!-- Create Goal Modal -->
    <div id="createGoalModal" class="modal hidden">
        <div class="modal-content create-goal-content">
            <div class="modal-header">
                <h3>Set New Goal</h3>
                <button onclick="closeCreateGoalModal()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="createGoalContainer">
                    <!-- Create goal form will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeCreateGoalModal()">Cancel</button>
                <button class="btn primary" onclick="createGoal()">Create Goal</button>
            </div>
        </div>
    </div>

    <!-- Habits Modal -->
    <div id="habitsModal" class="modal hidden">
        <div class="modal-content habits-content">
            <div class="modal-header">
                <h3>My Habits & Streaks</h3>
                <button onclick="closeHabitsModal()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="habitsContainer">
                    <!-- Habits content will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeHabitsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Motivational Message Toast -->
    <div id="motivationalToast" class="motivational-toast hidden">
        <div class="toast-content">
            <div class="toast-icon">🎉</div>
            <div class="toast-message" id="motivationalMessage"></div>
            <button onclick="closeMotivationalToast()" class="toast-close">×</button>
        </div>
    </div>

    <!-- Load Management Modal -->
    <div id="loadManagementModal" class="modal hidden">
        <div class="modal-content load-management-content">
            <div class="modal-header">
                <h3>Training Load & Recovery</h3>
                <button onclick="closeLoadManagementModal()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="loadManagementContainer">
                    <!-- Load management content will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeLoadManagementModal()">Close</button>
                <button class="btn primary" onclick="refreshLoadData()">Refresh Data</button>
            </div>
        </div>
    </div>

    <!-- Strava Import Modal -->
    <div id="stravaImportModal" class="modal hidden">
        <div class="modal-content strava-import-content">
            <div class="modal-header">
                <h3>Import Strava Activities</h3>
                <button onclick="closeStravaImportModal()" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="stravaImportContainer">
                    <!-- Strava import content will be dynamically loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeStravaImportModal()">Cancel</button>
                <button class="btn primary" onclick="importStravaActivities()">Import Activities</button>
            </div>
        </div>
    </div>

    <!-- AI Chat Toggle Button -->
    <button id="aiChatToggle" class="ai-chat-toggle" onclick="toggleAIChat()">
        🤖 AI Coach
    </button>

    <!-- Load modular JavaScript architecture -->
    <!-- Core Modules -->
    <script src="js/modules/core/ErrorBoundary.js"></script>
    <script src="js/modules/core/EventBus.js"></script>
    <script src="js/modules/core/SafeLogger.js"></script>
    <script src="js/modules/core/LegalCopy.js"></script>
    <script src="js/modules/core/FeatureFlags.js"></script>
    <script src="js/modules/data/StorageManager.js"></script>
    <script src="js/modules/debug/DebugManager.js"></script>
    
    <!-- UI Modules -->
    <script src="js/modules/ui/Router.js"></script>
    <script src="js/modules/ui/BottomNavigation.js"></script>
    <script src="js/modules/ui/MobileOptimizer.js"></script>
    <script src="js/modules/ui/GestureHandler.js"></script>
    <script src="js/modules/ui/ComponentLibrary.js"></script>
    <script src="js/modules/ui/TouchOptimizer.js"></script>
    <script src="js/modules/ui/DashboardHero.js"></script>
    <script src="js/modules/ui/SeasonPhase.js"></script>
    <script src="js/modules/ui/PersistentHeader.js"></script>
    <script src="js/modules/ui/TimerOverlay.js"></script>
    <script src="js/modules/ui/components/WorkoutTimer.js"></script>
    <script src="js/modules/ui/RPEInput.js"></script>
    <script src="js/modules/ui/PeriodizationView.js"></script>
    <script src="js/modules/ui/WhyThis.js"></script>
    <script src="js/modules/ui/UpgradeNudge.js"></script>
    <script src="js/modules/ui/components/ErrorAlert.js"></script>
    <script src="js/modules/ui/components/WhyPanel.js"></script>
    <script src="js/modules/ui/charts/Trends.js"></script>
    <script src="js/modules/ui/StravaImportUI.js"></script>
    
    <!-- Nutrition Modules -->
    <script src="js/modules/nutrition/NutritionCard.js"></script>
    <script src="js/modules/nutrition/MacroGuidance.js"></script>
    
    <!-- Settings Modules -->
    <script src="js/modules/settings/IntegrationPanel.js"></script>
    <script src="js/modules/settings/PrivacyPanel.js"></script>
    
    <!-- Integration Modules -->
    <script src="js/modules/integration/StravaProcessor.js"></script>
    
    <!-- Onboarding Modules -->
    <script src="js/modules/onboarding/SportSelection.js"></script>
    <script src="js/modules/onboarding/OnboardingManager.js"></script>
    <script src="js/modules/onboarding/steps/Goals.js"></script>
    <script src="js/modules/onboarding/steps/SportSoccer.js"></script>
    <script src="js/modules/onboarding/steps/EquipmentTime.js"></script>
    <script src="js/modules/onboarding/steps/Preferences.js"></script>
    
    <!-- Workout Modules -->
    <script src="js/modules/workout/ProgressionEngine.js"></script>
    <script src="js/modules/workout/ConflictResolver.js"></script>
    <script src="js/modules/workout/SessionOutcomeLogger.js"></script>
    <script src="js/modules/workout/LoadController.js"></script>
    <script src="js/modules/workout/WeightDisplay.js"></script>
    <script src="js/modules/settings/EquipmentPrefs.js"></script>
    <script src="js/modules/workout/ExerciseAdapter.js"></script>
    <script src="js/modules/workout/WorkoutTracker.js"></script>
    <script src="js/modules/workout/WeightMath.js"></script>
    
    <!-- Sport-Specific Modules -->
    <script src="js/modules/sports/SportDefinitions.js"></script>
    <script src="js/modules/sports/PositionTraining.js"></script>
    <script src="js/modules/sports/SeasonalPrograms.js"></script>
    <script src="js/modules/sports/SoccerExercises.js"></script>
    <script src="js/modules/sports/ExerciseProgression.js"></script>
    
    <!-- Injury Prevention Modules -->
    <script src="js/modules/assessment/MovementScreens.js"></script>
    <script src="js/modules/assessment/ScreeningResults.js"></script>
    <script src="js/modules/injury/CorrectiveExercises.js"></script>
    <script src="js/modules/injury/RiskAssessment.js"></script>
    <script src="js/modules/injury/PreventionProtocols.js"></script>
    <script src="js/modules/injury/InjuryCheck.js"></script>
    
    <!-- Authentication Modules -->
    <script src="js/modules/auth/AuthManager.js"></script>
    <script src="js/modules/auth/SessionManager.js"></script>
    
    <!-- Data Modules -->
    <script src="js/modules/data/StorageManager.js"></script>
    <script src="js/modules/data/ApiClient.js"></script>
    <script src="js/modules/data/ExerciseDatabase.js"></script>
    
    <!-- Workout Modules -->
    <script src="js/modules/workout/WorkoutTracker.js"></script>
    <script src="js/modules/workout/ProgressionEngine.js"></script>
    
    <!-- AI Modules -->
    <script src="js/modules/ai/PersonalizedCoaching.js"></script>
    <script src="js/modules/ai/CoachingEngine.js"></script>
    
    <!-- Onboarding Modules -->
    <script src="js/modules/onboarding/OnboardingManager.js"></script>
    
    <!-- UI Modules -->
    <script src="js/modules/ui/DashboardRenderer.js"></script>
    
    <!-- Readiness Modules -->
    <script src="js/modules/readiness/DailyCheckIn.js"></script>
    <script src="js/modules/readiness/RecoverySummary.js"></script>
    <script src="js/modules/readiness/PassiveReadiness.js"></script>
    
    <!-- Progression Modules -->
    <script src="js/modules/workout/ProgressionEngine.js"></script>
    <script src="js/modules/workout/ExerciseAdapter.js"></script>
    
    <!-- Goals & Habits Modules -->
    <script src="js/modules/goals/GoalManager.js"></script>
    <script src="js/modules/habits/HabitTracker.js"></script>
    
    <!-- AI Expert Coordination Brain -->
    <script src="js/modules/ai/AIDataValidator.js"></script>
    <script src="netlify/functions/utils/ai-context-database.js"></script>
    <script src="js/modules/ai/context/CoordinatorContext.js"></script>
    <script src="js/modules/ai/experts/StrengthCoach.js"></script>
    <script src="js/modules/ai/experts/SportsCoach.js"></script>
    <script src="js/modules/ai/experts/PhysioCoach.js"></script>
    <script src="js/modules/ai/experts/NutritionCoach.js"></script>
    <script src="js/modules/ai/experts/AestheticsCoach.js"></script>
    <script src="js/modules/ai/ExpertCoordinator.js"></script>
    <script src="js/modules/ai/WhyThisDecider.js"></script>
    <script src="js/modules/ai/CoachChat.js"></script>
    
    <!-- Mode Management & UI -->
    <script src="js/modules/ui/ModeManager.js"></script>
    <script src="js/modules/ui/QuickStart.js"></script>
    <script src="js/modules/ui/OverrideBar.js"></script>
    
    <!-- Strava Integration & Load Management -->
    <script src="js/modules/integration/StravaProcessor.js"></script>
    <script src="js/modules/integration/StravaHook.js"></script>
    <script src="js/modules/load/LoadController.js"></script>
    <script src="js/modules/load/LoadCalculator.js"></script>
    <script src="js/modules/load/ExternalLoadAdapter.js"></script>
    
    <!-- Legacy Modules (for compatibility) -->
    <script src="js/core/data-store.js"></script>
    <script src="js/training/workout-generator.js"></script>
    <script src="js/ai/pattern-detector.js"></script>
    <script src="js/ai/context-aware-ai.js"></script>
    <script src="js/training/seasonal-training.js"></script>
    
    <!-- Main Application -->
    <script src="js/app-modular.js"></script>
    
    <!-- Lighthouse Optimization -->
    <script src="js/lighthouse-optimization.js"></script>
    
    <!-- Prompt 0.1 Verification -->
    <script src="test-prompt01-verification.js"></script>
    
    <!-- Prompt 0.2 Verification -->
    <script src="test-prompt02-verification.js"></script>
    
    <!-- Prompt 1.1 Verification -->
    <script src="test-prompt11-verification.js"></script>
    
    <!-- Prompt 5 Verification -->
    <script src="test-prompt05-nutrition.js"></script>
    
    <!-- Prompt 6 Verification -->
    <script src="test-prompt06-substitution.js"></script>
    
    <!-- Prompt 7 Verification -->
    <script src="test-prompt07-why-this.js"></script>
    
    <!-- Prompt 8 Verification -->
    <script src="test-prompt08-passive-readiness.js"></script>
    
    <!-- Prompt 9 Verification -->
    <script src="test-prompt09-workout-flow.js"></script>
    
    <!-- Prompt 10 Verification -->
    <script src="test-prompt10-periodization.js"></script>
    
    <!-- Prompt 11 Verification -->
    <script src="test-prompt11-privacy.js"></script>
    
    <!-- Prompt 12 Verification -->
    <script src="test-prompt12-feature-flags.js"></script>
    
    <!-- Prompt 1.2 Verification -->
    <script src="test-prompt12-verification.js"></script>
    
    <!-- Prompt 2.1 Verification -->
    <script src="test-prompt21-verification.js"></script>
    
    <!-- Prompt 2.2 Verification -->
    <script src="test-prompt22-verification.js"></script>
    
    <!-- Prompt 3.1 Verification -->
    <script src="test-prompt31-verification.js"></script>
    
    <!-- Prompt 3.2 Verification -->
    <script src="test-prompt32-verification.js"></script>
    
    <!-- Prompt 4.1 Verification -->
    <script src="test-prompt41-verification.js"></script>
    
    <!-- Prompt 5.1 Verification -->
    <script src="test-prompt51-verification.js"></script>
    
    <!-- Service Worker Registration -->
    </div>

    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content is available, show update notification
                                    if (confirm('New version available! Reload to update?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Update connection status
        function updateConnectionStatus() {
            const statusElement = document.getElementById('sync-status');
            if (navigator.onLine) {
                statusElement.innerHTML = '🟢 Online';
                statusElement.style.background = '#2d3748';
            } else {
                statusElement.innerHTML = '🔴 Offline';
                statusElement.style.background = '#e53e3e';
            }
        }
        
        // Listen for connection changes
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        
        // Initial status check
        updateConnectionStatus();
        
        // Personal Data Functions
        function savePersonalInfo() {
            const age = document.getElementById('age').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('height').value;
            const heightUnit = document.getElementById('heightUnit').value;
            const heightFeet = document.getElementById('heightFeet').value;
            const heightInches = document.getElementById('heightInches').value;
            const experience = document.getElementById('experience').value;
            const sportSpecific = document.getElementById('sportSpecific').checked;
            const sport = document.getElementById('sport').value;
            const seasonPhase = document.getElementById('seasonPhase').value;
            
            if (!age || !weight || !experience) {
                showStatus('personalDataStatus', 'Please fill in all required fields', 'error');
                return;
            }
            
            let finalHeight = height;
            if (heightUnit === 'ft' && heightFeet && heightInches) {
                // Convert feet and inches to cm
                finalHeight = (parseInt(heightFeet) * 30.48) + (parseInt(heightInches) * 2.54);
            }
            
            const personalInfo = {
                age: parseInt(age),
                weight: parseFloat(weight),
                height: parseFloat(finalHeight),
                heightUnit: heightUnit,
                heightFeet: heightFeet ? parseInt(heightFeet) : null,
                heightInches: heightInches ? parseInt(heightInches) : null,
                experience: experience,
                sportSpecific: sportSpecific,
                sport: sport,
                seasonPhase: seasonPhase,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('ignitefitness_personal_info', JSON.stringify(personalInfo));
            
            // Update seasonal phase indicator if sport-specific training is enabled
            if (sportSpecific && seasonPhase) {
                updateSeasonalPhaseDisplay(seasonPhase);
            }
            
            showStatus('personalDataStatus', '✅ Personal information saved! Your data will be remembered when you return.', 'success');
        }
        
        // Clear all saved data (for testing/debugging)
        function clearAllData() {
            if (confirm('Are you sure you want to clear all saved data? This action cannot be undone.')) {
                localStorage.removeItem('ignitefitness_personal_info');
                localStorage.removeItem('ignitefitness_goals');
                localStorage.removeItem('ignitefitness_workout_calendar');
                localStorage.removeItem('ignitefitness_injury_prevention');
                alert('All data cleared! Refreshing page...');
                window.location.reload();
            }
        }
        
        function updateSeasonalPhaseDisplay(phase) {
            const phaseNames = {
                'off': 'Off-Season',
                'pre': 'Pre-Season',
                'mid': 'Mid-Season',
                'playoffs': 'Playoffs',
                'post': 'Post-Season'
            };
            
            const phaseElement = document.getElementById('currentPhaseName');
            if (phaseElement && phaseNames[phase]) {
                phaseElement.textContent = phaseNames[phase];
            }
        }
        
        function toggleSportSpecific() {
            const sportSpecific = document.getElementById('sportSpecific').checked;
            const sportOptions = document.getElementById('sportSpecificOptions');
            
            if (sportSpecific) {
                sportOptions.style.display = 'block';
            } else {
                sportOptions.style.display = 'none';
            }
        }
        
        function toggleHeightUnit() {
            const heightUnit = document.getElementById('heightUnit').value;
            const heightFeetInches = document.getElementById('heightFeetInches');
            const heightInput = document.getElementById('height');
            
            if (heightUnit === 'ft') {
                heightFeetInches.style.display = 'flex';
                heightInput.placeholder = 'Enter height in cm (auto-converted)';
            } else {
                heightFeetInches.style.display = 'none';
                heightInput.placeholder = 'Enter your height';
            }
        }
        
        // Training Goals Functions
        function saveGoals() {
            const selectedGoals = [];
            const goalCheckboxes = document.querySelectorAll('input[name="trainingGoals"]:checked');
            
            goalCheckboxes.forEach(checkbox => {
                selectedGoals.push(checkbox.value);
            });
            
            if (selectedGoals.length === 0) {
                showStatus('goalsStatus', 'Please select at least one training goal', 'error');
                return;
            }
            
            // Get frequency preferences
            const frequencyPreferences = {
                weightTraining: parseInt(document.getElementById('weightTrainingDays').value),
                soccerTraining: parseInt(document.getElementById('soccerTrainingDays').value),
                cardio: parseInt(document.getElementById('cardioDays').value),
                recovery: parseInt(document.getElementById('recoveryDays').value),
                yoga: parseInt(document.getElementById('yogaDays').value)
            };
            
            const autoAssign = document.getElementById('autoAssignWorkouts').checked;
            
            const goals = {
                selectedGoals: selectedGoals,
                frequencyPreferences: frequencyPreferences,
                autoAssign: autoAssign,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('ignitefitness_goals', JSON.stringify(goals));
            showStatus('goalsStatus', `✅ Saved ${selectedGoals.length} goals and frequency preferences! Your settings will be remembered.`, 'success');
            
            // Auto-assign workouts if enabled
            if (autoAssign) {
                autoAssignWorkouts();
            }
        }
        
        function toggleAutoAssignment() {
            const autoAssign = document.getElementById('autoAssignWorkouts').checked;
            const helpText = document.querySelector('.help-text');
            
            if (autoAssign) {
                helpText.textContent = 'Workouts will be automatically scheduled based on your frequency preferences.';
            } else {
                helpText.textContent = 'You can manually schedule workouts using the calendar below.';
            }
        }
        
        // Enhanced Workout Calendar Functions
        function saveWorkoutCalendar() {
            const calendarData = {};
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            days.forEach(day => {
                const dayWorkouts = document.getElementById(`${day}-workouts`);
                const workouts = [];
                
                dayWorkouts.querySelectorAll('.workout-item').forEach(workout => {
                    const type = workout.querySelector('.workout-type').textContent;
                    const duration = workout.querySelector('.workout-duration').textContent;
                    workouts.push({ type, duration });
                });
                
                calendarData[day] = workouts;
            });
            
            localStorage.setItem('ignitefitness_workout_calendar', JSON.stringify(calendarData));
            showStatus('calendarStatus', '✅ Workout schedule saved! Your weekly plan will be remembered.', 'success');
        }
        
        function addWorkout(day) {
            const workoutTypes = [
                { value: 'weight_training', label: 'Weight Training', duration: '60 min' },
                { value: 'indoor_soccer_game', label: 'Indoor Soccer Game', duration: '60 min' },
                { value: 'outdoor_soccer_game', label: 'Outdoor Soccer Game', duration: '90 min' },
                { value: 'soccer_practice', label: 'Soccer Practice', duration: '90 min' },
                { value: 'cardio', label: 'Cardio', duration: '45 min' },
                { value: 'yoga', label: 'Yoga', duration: '30 min' },
                { value: 'recovery', label: 'Recovery', duration: '30 min' },
                { value: 'flexibility', label: 'Flexibility', duration: '20 min' },
                { value: 'injury_prevention', label: 'Injury Prevention', duration: '25 min' }
            ];
            
            // Create workout selection modal
            const modal = document.createElement('div');
            modal.className = 'workout-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h4>Add Workout to ${day.charAt(0).toUpperCase() + day.slice(1)}</h4>
                    <div class="workout-options">
                        ${workoutTypes.map(workout => `
                            <div class="workout-option" onclick="selectWorkout('${day}', '${workout.value}', '${workout.label}', '${workout.duration}')">
                                <div class="workout-name">${workout.label}</div>
                                <div class="workout-duration">${workout.duration}</div>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn secondary" onclick="closeWorkoutModal()">Cancel</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function selectWorkout(day, type, label, duration) {
            const dayWorkouts = document.getElementById(`${day}-workouts`);
            const workoutId = `workout-${Date.now()}`;
            
            const workoutItem = document.createElement('div');
            workoutItem.className = 'workout-item';
            workoutItem.id = workoutId;
            workoutItem.innerHTML = `
                <div class="workout-info">
                    <div class="workout-type">${label}</div>
                    <div class="workout-duration">${duration}</div>
                </div>
                <div class="workout-actions">
                    <button class="workout-btn edit-btn" onclick="editWorkout('${workoutId}')" title="Edit">✏️</button>
                    <button class="workout-btn delete-btn" onclick="removeWorkout('${workoutId}')" title="Delete">🗑️</button>
                </div>
            `;
            
            dayWorkouts.appendChild(workoutItem);
            closeWorkoutModal();
        }
        
        function removeWorkout(workoutId) {
            const workout = document.getElementById(workoutId);
            if (workout) {
                workout.remove();
            }
        }
        
        function editWorkout(workoutId) {
            // Implement workout editing functionality
            console.log('Edit workout:', workoutId);
        }
        
        function closeWorkoutModal() {
            const modal = document.querySelector('.workout-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function autoAssignWorkouts() {
            // Get frequency preferences from localStorage
            const goals = JSON.parse(localStorage.getItem('ignitefitness_goals') || '{}');
            const frequencyPreferences = goals.frequencyPreferences || {
                weightTraining: 3,
                soccerTraining: 2,
                cardio: 3,
                recovery: 2,
                yoga: 7
            };
            
            // Clear existing workouts
            clearSchedule();
            
            // Auto-assign based on preferences
            const workoutTypes = [
                { type: 'weight_training', label: 'Weight Training', duration: '60 min', days: frequencyPreferences.weightTraining },
                { type: 'indoor_soccer_game', label: 'Indoor Soccer Game', duration: '60 min', days: Math.ceil(frequencyPreferences.soccerTraining / 3) },
                { type: 'outdoor_soccer_game', label: 'Outdoor Soccer Game', duration: '90 min', days: Math.ceil(frequencyPreferences.soccerTraining / 3) },
                { type: 'soccer_practice', label: 'Soccer Practice', duration: '90 min', days: Math.floor(frequencyPreferences.soccerTraining / 3) },
                { type: 'cardio', label: 'Cardio', duration: '45 min', days: frequencyPreferences.cardio },
                { type: 'yoga', label: 'Yoga', duration: '30 min', days: frequencyPreferences.yoga },
                { type: 'recovery', label: 'Recovery', duration: '30 min', days: frequencyPreferences.recovery }
            ];
            
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            workoutTypes.forEach(workoutType => {
                if (workoutType.days > 0) {
                    if (workoutType.days === 7) {
                        // Daily workouts (like yoga) - assign to every day
                        days.forEach(day => {
                            selectWorkout(day, workoutType.type, workoutType.label, workoutType.duration);
                        });
                    } else {
                        // Distribute workouts evenly across the week
                        const interval = Math.floor(7 / workoutType.days);
                        for (let i = 0; i < workoutType.days; i++) {
                            const dayIndex = (i * interval) % 7;
                            const day = days[dayIndex];
                            selectWorkout(day, workoutType.type, workoutType.label, workoutType.duration);
                        }
                    }
                }
            });
            
            showStatus('calendarStatus', 'Workouts auto-assigned based on your preferences!', 'success');
        }
        
        function clearSchedule() {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            days.forEach(day => {
                const dayWorkouts = document.getElementById(`${day}-workouts`);
                dayWorkouts.innerHTML = '';
            });
        }
        
        // Utility Functions
        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `save-status ${type}`;
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                statusElement.className = 'save-status';
                statusElement.textContent = '';
            }, 3000);
        }
        
        // Injury Prevention Functions
        function toggleInjuryPrevention() {
            const injuryPrevention = document.getElementById('injuryPrevention').checked;
            const injuryOptions = document.getElementById('injuryPreventionOptions');
            
            if (injuryPrevention) {
                injuryOptions.style.display = 'block';
                updateInjuryPrevention();
            } else {
                injuryOptions.style.display = 'none';
            }
        }
        
        function updateInjuryPrevention() {
            const sport = document.getElementById('sport').value;
            const injuryPrevention = document.getElementById('injuryPrevention').checked;
            
            if (!injuryPrevention || !sport) return;
            
            const recommendations = getSportSpecificRecommendations(sport);
            const recommendationsDiv = document.getElementById('injuryPreventionRecommendations');
            const aclSection = document.getElementById('aclPreventionSection');
            
            if (recommendations) {
                recommendationsDiv.innerHTML = `
                    <h6>${sport.charAt(0).toUpperCase() + sport.slice(1)}-Specific Recommendations:</h6>
                    <ul>
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                `;
            }
            
            // Show ACL prevention section for soccer players
            if (sport === 'soccer') {
                aclSection.style.display = 'block';
            } else {
                aclSection.style.display = 'none';
            }
        }
        
        // Check for ACL injury history and show special protocol
        function checkACLHistory() {
            const aclInjury = document.querySelector('input[name="previousInjuries"][value="acl"]');
            const aclSection = document.getElementById('aclPreventionSection');
            
            if (aclInjury && aclInjury.checked) {
                aclSection.style.display = 'block';
                aclSection.innerHTML = `
                    <h5>ACL Recovery & Prevention Protocol</h5>
                    <div class="acl-protocol">
                        <div class="protocol-phase">
                            <h6>Post-ACL Recovery Phase</h6>
                            <ul>
                                <li>Focus on quad strength restoration</li>
                                <li>Progressive single-leg balance</li>
                                <li>Controlled range of motion</li>
                                <li>Gradual return to sport activities</li>
                            </ul>
                        </div>
                        <div class="protocol-phase">
                            <h6>Prevention Maintenance</h6>
                            <ul>
                                <li>Daily balance training</li>
                                <li>Hamstring-to-quad ratio monitoring</li>
                                <li>Landing mechanics practice</li>
                                <li>Sport-specific movement patterns</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }
        
        function getSportSpecificRecommendations(sport) {
            const recommendations = {
                soccer: [
                    'ACL injury prevention through proper landing mechanics',
                    'Focus on ankle stability exercises',
                    'Include hamstring flexibility work',
                    'Add single-leg balance training',
                    'Incorporate hip mobility exercises',
                    'Include quad-to-hamstring strength ratio training',
                    'Add lateral movement and cutting mechanics',
                    'Focus on deceleration and change of direction'
                ],
                basketball: [
                    'Emphasize knee strengthening',
                    'Include ankle stability work',
                    'Add core stability exercises',
                    'Focus on landing mechanics'
                ],
                tennis: [
                    'Include shoulder mobility exercises',
                    'Add wrist and forearm strengthening',
                    'Focus on rotational core work',
                    'Include lateral movement training'
                ],
                running: [
                    'Emphasize hip strengthening',
                    'Include calf flexibility work',
                    'Add single-leg stability',
                    'Focus on running form drills'
                ],
                cycling: [
                    'Include hip flexor stretches',
                    'Add core stability work',
                    'Focus on knee tracking',
                    'Include upper body mobility'
                ],
                swimming: [
                    'Include shoulder mobility',
                    'Add core stability exercises',
                    'Focus on hip flexibility',
                    'Include breathing exercises'
                ]
            };
            
            return recommendations[sport] || ['General injury prevention exercises recommended'];
        }
        
        function updatePreventionExercises() {
            const focus = document.getElementById('preventionFocus').value;
            const exerciseList = document.getElementById('exerciseList');
            
            if (!focus) {
                exerciseList.innerHTML = '<p>Select a focus area to see recommended exercises.</p>';
                return;
            }
            
            const exercises = getPreventionExercises(focus);
            exerciseList.innerHTML = exercises.map(exercise => `
                <div class="exercise-item">
                    <h6>${exercise.name}</h6>
                    <p>${exercise.description}</p>
                    <span class="exercise-type">${exercise.type}</span>
                </div>
            `).join('');
        }
        
        function getPreventionExercises(focus) {
            const exerciseDatabase = {
                ankle_stability: [
                    {
                        name: 'Single-Leg Balance',
                        description: 'Stand on one leg for 30-60 seconds, progress to eyes closed',
                        type: 'Balance'
                    },
                    {
                        name: 'Ankle Circles',
                        description: 'Sit and rotate ankle in both directions, 10 reps each',
                        type: 'Mobility'
                    },
                    {
                        name: 'Calf Raises',
                        description: 'Rise up on toes, hold 2 seconds, lower slowly. 3 sets of 15',
                        type: 'Strength'
                    }
                ],
                acl_prevention: [
                    {
                        name: 'Single-Leg Landing',
                        description: 'Jump off box, land on one leg with soft knee bend, hold 3 seconds',
                        type: 'Plyometric'
                    },
                    {
                        name: 'Nordic Hamstring Curls',
                        description: 'Kneel, partner holds ankles, lower slowly, return to start',
                        type: 'Strength'
                    },
                    {
                        name: 'Lateral Bounds',
                        description: 'Jump laterally side to side, land softly with knee over toe',
                        type: 'Plyometric'
                    },
                    {
                        name: 'Single-Leg RDL',
                        description: 'Stand on one leg, hinge at hip, reach opposite hand to ground',
                        type: 'Strength'
                    },
                    {
                        name: 'Lateral Lunges',
                        description: 'Step sideways into lunge, keep knee tracking over toe',
                        type: 'Strength'
                    },
                    {
                        name: 'Jump Landing Mechanics',
                        description: 'Jump and land with knees over toes, soft landing, 3 sets of 8',
                        type: 'Plyometric'
                    }
                ],
                knee_strength: [
                    {
                        name: 'Wall Sits',
                        description: 'Hold seated position against wall for 30-60 seconds',
                        type: 'Strength'
                    },
                    {
                        name: 'Step-Ups',
                        description: 'Step up onto box, control descent. 3 sets of 10 each leg',
                        type: 'Strength'
                    },
                    {
                        name: 'Lateral Lunges',
                        description: 'Step sideways into lunge position, return to center',
                        type: 'Strength'
                    }
                ],
                hamstring_flexibility: [
                    {
                        name: 'Dynamic Leg Swings',
                        description: 'Swing leg forward/back and side to side, 10 each direction',
                        type: 'Mobility'
                    },
                    {
                        name: 'Seated Hamstring Stretch',
                        description: 'Sit with leg extended, reach toward toes, hold 30 seconds',
                        type: 'Flexibility'
                    },
                    {
                        name: 'Romanian Deadlifts',
                        description: 'Hinge at hips, feel stretch in hamstrings, 3 sets of 12',
                        type: 'Strength'
                    }
                ],
                shoulder_mobility: [
                    {
                        name: 'Arm Circles',
                        description: 'Large circles forward and backward, 10 each direction',
                        type: 'Mobility'
                    },
                    {
                        name: 'Shoulder Blade Squeezes',
                        description: 'Squeeze shoulder blades together, hold 5 seconds, 15 reps',
                        type: 'Strength'
                    },
                    {
                        name: 'Doorway Stretch',
                        description: 'Place arm on doorframe, lean forward to stretch chest',
                        type: 'Flexibility'
                    }
                ],
                core_stability: [
                    {
                        name: 'Plank',
                        description: 'Hold straight line from head to heels, 30-60 seconds',
                        type: 'Strength'
                    },
                    {
                        name: 'Dead Bug',
                        description: 'Lie on back, extend opposite arm/leg, return to start',
                        type: 'Stability'
                    },
                    {
                        name: 'Bird Dog',
                        description: 'On hands and knees, extend opposite arm/leg, hold 5 seconds',
                        type: 'Stability'
                    }
                ],
                balance_training: [
                    {
                        name: 'Single-Leg Stand',
                        description: 'Stand on one leg, progress to eyes closed, 30-60 seconds',
                        type: 'Balance'
                    },
                    {
                        name: 'Heel-to-Toe Walk',
                        description: 'Walk in straight line, heel to toe, 20 steps',
                        type: 'Balance'
                    },
                    {
                        name: 'Bosu Ball Squats',
                        description: 'Squat on unstable surface, 3 sets of 10',
                        type: 'Stability'
                    }
                ]
            };
            
            return exerciseDatabase[focus] || [];
        }
        
        function togglePreventionInWorkout() {
            const includePrevention = document.getElementById('includePrevention').checked;
            // This would integrate with the workout generation system
            console.log('Include prevention exercises:', includePrevention);
        }
        
        function saveInjuryPrevention() {
            const preventionFocus = document.getElementById('preventionFocus').value;
            const includePrevention = document.getElementById('includePrevention').checked;
            const previousInjuries = [];
            const injuryCheckboxes = document.querySelectorAll('input[name="previousInjuries"]:checked');
            
            injuryCheckboxes.forEach(checkbox => {
                previousInjuries.push(checkbox.value);
            });
            
            const injuryPreventionData = {
                preventionFocus: preventionFocus,
                includePrevention: includePrevention,
                previousInjuries: previousInjuries,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('ignitefitness_injury_prevention', JSON.stringify(injuryPreventionData));
            showStatus('preventionStatus', '✅ Injury prevention settings saved!', 'success');
        }
        
        function toggleRole() {
            try {
                const currentPreferences = JSON.parse(localStorage.getItem('ignitefitness_preferences') || '{}');
                const currentRole = currentPreferences.role || 'athlete';
                const newRole = currentRole === 'athlete' ? 'coach' : 'athlete';
                
                currentPreferences.role = newRole;
                localStorage.setItem('ignitefitness_preferences', JSON.stringify(currentPreferences));
                
                // Show success notification
                alert(`Switched to ${newRole} mode! Reloading page...`);
                
                // Reload the page to apply the changes
                window.location.reload();
            } catch (error) {
                console.error('Error switching role:', error);
                alert('Failed to switch role. Please try again.');
            }
        }
        
        function viewWorkoutPlan() {
            // Switch to the Workout Plan tab
            const workoutPlanTab = document.querySelector('.tab-btn[onclick*="workoutPlan"]');
            if (workoutPlanTab) {
                workoutPlanTab.click();
            } else {
                // Fallback: manually switch tab
                showTab('workoutPlan', null);
            }
        }
        
        // Add tooltip for training periodization
        function showPeriodizationInfo() {
            const info = `
Training Periodization (65%):
    
This shows how far you are through your current training cycle (4-8 weeks).

• Week 1-2: Base Building (65% = ~Week 2-3)
• Week 3-4: Progression Phase
• Week 5-6: Peak/Peaking Phase  
• Week 7-8: Deload/Recovery Week

The 65% means you're about 2 weeks into your current cycle, progressing through base building toward your peak performance period.

This structured approach helps prevent overtraining and ensures you're at your best for important competitions or goals.
            `;
            alert(info);
        }
        
        // Debug utilities are now handled by DebugManager module
        // Available functions: checkSavedData(), debugStorage(), debugUsers(), debugPerformance(), etc.
        
        // Load saved data functions
        function loadPersonalInfo() {
            try {
                const savedData = JSON.parse(localStorage.getItem('ignitefitness_personal_info') || '{}');
                
                if (Object.keys(savedData).length === 0) return;
                
                // Load basic info
                if (savedData.age) document.getElementById('age').value = savedData.age;
                if (savedData.weight) document.getElementById('weight').value = savedData.weight;
                if (savedData.experience) document.getElementById('experience').value = savedData.experience;
                
                // Load height
                if (savedData.heightUnit) {
                    document.getElementById('heightUnit').value = savedData.heightUnit;
                    
                    if (savedData.heightUnit === 'ft') {
                        // Use saved feet and inches if available
                        if (savedData.heightFeet) {
                            document.getElementById('heightFeet').value = savedData.heightFeet;
                        }
                        if (savedData.heightInches) {
                            document.getElementById('heightInches').value = savedData.heightInches;
                        }
                        toggleHeightUnit(); // Show feet & inches inputs
                    } else {
                        document.getElementById('height').value = savedData.height;
                        toggleHeightUnit(); // Hide feet & inches inputs
                    }
                }
                
                // Load sport-specific info
                if (savedData.sportSpecific) {
                    document.getElementById('sportSpecific').checked = true;
                    toggleSportSpecific();
                    if (savedData.sport) document.getElementById('sport').value = savedData.sport;
                    if (savedData.seasonPhase) document.getElementById('seasonPhase').value = savedData.seasonPhase;
                }
                
                console.log('Personal info loaded successfully');
            } catch (error) {
                console.error('Error loading personal info:', error);
            }
        }
        
        function loadGoals() {
            try {
                const savedData = JSON.parse(localStorage.getItem('ignitefitness_goals') || '{}');
                
                if (Object.keys(savedData).length === 0) return;
                
                // Load selected goals
                if (savedData.selectedGoals) {
                    savedData.selectedGoals.forEach(goal => {
                        const checkbox = document.querySelector(`input[name="trainingGoals"][value="${goal}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
                // Load frequency preferences
                if (savedData.frequencyPreferences) {
                    const freq = savedData.frequencyPreferences;
                    if (freq.weightTraining) document.getElementById('weightTrainingDays').value = freq.weightTraining;
                    if (freq.soccerTraining) document.getElementById('soccerTrainingDays').value = freq.soccerTraining;
                    if (freq.cardio) document.getElementById('cardioDays').value = freq.cardio;
                    if (freq.recovery) document.getElementById('recoveryDays').value = freq.recovery;
                    if (freq.yoga) document.getElementById('yogaDays').value = freq.yoga;
                }
                
                // Load auto-assignment preference
                if (savedData.autoAssign !== undefined) {
                    document.getElementById('autoAssignWorkouts').checked = savedData.autoAssign;
                    toggleAutoAssignment();
                }
                
                console.log('Goals loaded successfully');
            } catch (error) {
                console.error('Error loading goals:', error);
            }
        }
        
        function loadWorkoutCalendar() {
            try {
                const savedData = JSON.parse(localStorage.getItem('ignitefitness_workout_calendar') || '{}');
                
                if (Object.keys(savedData).length === 0) return;
                
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                
                days.forEach(day => {
                    if (savedData[day] && Array.isArray(savedData[day])) {
                        savedData[day].forEach(workout => {
                            selectWorkout(day, workout.type, workout.label || workout.type, workout.duration);
                        });
                    }
                });
                
                console.log('Workout calendar loaded successfully');
            } catch (error) {
                console.error('Error loading workout calendar:', error);
            }
        }
        
        // Initialize height unit toggle and ACL injury monitoring
        document.addEventListener('DOMContentLoaded', function() {
            const heightUnitSelect = document.getElementById('heightUnit');
            if (heightUnitSelect) {
                heightUnitSelect.addEventListener('change', toggleHeightUnit);
            }
            
            // Add event listeners for ACL injury history
            const injuryCheckboxes = document.querySelectorAll('input[name="previousInjuries"]');
            injuryCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', checkACLHistory);
            });
            
            // Load saved seasonal phase on page load
            const personalInfo = JSON.parse(localStorage.getItem('ignitefitness_personal_info') || '{}');
            if (personalInfo.seasonPhase) {
                updateSeasonalPhaseDisplay(personalInfo.seasonPhase);
            }
            
            // Load all saved data
            loadPersonalInfo();
            loadGoals();
            loadWorkoutCalendar();
            
            // Debug: Log when loading
            console.log('Page loaded, attempting to load saved data...');
        });
        
        // Show seasonal phase modal
        function showPhaseModal() {
            const phase = document.getElementById('seasonPhase')?.value || 'off';
            const phaseNames = {
                off: 'Off-Season',
                pre: 'Pre-Season',
                mid: 'Mid-Season',
                playoffs: 'Playoffs',
                post: 'Post-Season'
            };
            const phaseDescription = {
                off: 'This is the recovery and base-building phase. Focus on maintaining fitness, addressing imbalances, and building a solid foundation for the next season.',
                pre: 'This phase focuses on building sport-specific fitness, improving strength and conditioning, and preparing for the competitive season ahead.',
                mid: 'During the competitive season, the focus is on maintaining fitness while managing fatigue and ensuring optimal performance during games/matches.',
                playoffs: 'The most intense phase. Focus shifts to peak performance, recovery optimization, and maintaining freshness for critical games.',
                post: 'Active recovery phase after the season ends. Focus on physical and mental recovery while maintaining light activity levels.'
            };
            
            alert(`${phaseNames[phase] || 'Off-Season'}\n\n${phaseDescription[phase] || phaseDescription.off}`);
        }
        
        // Manual sync function
        function manualSync() {
            // Update status to show syncing
            const syncStatusEl = document.getElementById('syncStatus');
            if (syncStatusEl) {
                syncStatusEl.textContent = '🔄 Syncing...';
            }
            
            // Simulate sync process
            setTimeout(() => {
                const now = new Date().toLocaleTimeString();
                const lastSyncEl = document.getElementById('lastSync');
                if (lastSyncEl) {
                    lastSyncEl.textContent = `Last sync: ${now}`;
                }
                
                if (syncStatusEl) {
                    syncStatusEl.textContent = '✅ Synced';
                }
                
                console.log('Data synced successfully at ' + now);
                
                // Reset status after 3 seconds
                setTimeout(() => {
                    if (syncStatusEl) {
                        syncStatusEl.textContent = '🔄 Syncing...';
                    }
                }, 3000);
            }, 1500);
        }
        
        // Strava Integration Functions
        function connectToStrava() {
            console.log('Connecting to Strava...');
            
            // Check if we have a Strava Client ID configured
            const stravaClientId = getStravaClientId();
            if (!stravaClientId) {
                alert('Strava Client ID not configured. Please set up Strava OAuth credentials in the environment variables.');
                return;
            }
            
            // Generate state parameter for security
            const state = 'ignite_fitness_' + Date.now();
            localStorage.setItem('strava_oauth_state', state);
            
            // Build OAuth URL
            const redirectUri = encodeURIComponent(window.location.origin + '/callback.html');
            const scope = 'read,activity:read'; // Request read permissions for activities
            const responseType = 'code';
            
            const authUrl = `https://www.strava.com/oauth/authorize?client_id=${stravaClientId}&redirect_uri=${redirectUri}&response_type=${responseType}&scope=${scope}&state=${state}&approval_prompt=force`;
            
            // Redirect to Strava authorization page
            window.location.href = authUrl;
        }
        
        function getStravaClientId() {
            // In production, this should come from environment variables or backend
            // For now, check if it's set in localStorage (set via admin panel)
            const clientId = localStorage.getItem('strava_client_id');
            
            if (clientId) {
                return clientId;
            }
            
            // Default client ID for testing (you should replace this with your own)
            // Get your client ID from: https://www.strava.com/settings/api
            return null; // Return null to prompt user to configure
        }
        
        function disconnectFromStrava() {
            console.log('Disconnecting from Strava...');
            
            // Remove all Strava tokens and data
            localStorage.removeItem('strava_access_token');
            localStorage.removeItem('strava_refresh_token');
            localStorage.removeItem('strava_token_expires');
            localStorage.removeItem('strava_athlete_id');
            localStorage.removeItem('strava_athlete_name');
            localStorage.removeItem('strava_oauth_state');
            
            // Update UI
            checkStravaConnection();
            
            alert('Disconnected from Strava successfully.');
        }
        
        async function syncStravaData() {
            console.log('Syncing Strava data...');
            
            // Check if connected
            const accessToken = localStorage.getItem('strava_access_token');
            if (!accessToken) {
                alert('Please connect to Strava first.');
                return;
            }
            
            // Show syncing status
            const syncBtn = document.getElementById('stravaSyncBtn');
            if (syncBtn) {
                syncBtn.disabled = true;
                syncBtn.textContent = 'Syncing...';
            }
            
            try {
                // Fetch activities from Strava API
                // Get activities from last 30 days
                const afterTimestamp = Math.floor(Date.now() / 1000) - (30 * 24 * 60 * 60);
                const apiUrl = `https://www.strava.com/api/v3/athlete/activities?after=${afterTimestamp}&per_page=30`;
                
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Access token expired. Please reconnect to Strava.');
                    }
                    throw new Error(`Strava API error: ${response.status} ${response.statusText}`);
                }
                
                const activities = await response.json();
                
                // Process activities using StravaProcessor
                if (window.StravaProcessor && activities.length > 0) {
                    activities.forEach(activity => {
                        try {
                            const processed = window.StravaProcessor.processActivity(activity);
                            console.log('Processed activity:', processed);
                        } catch (error) {
                            console.error('Error processing activity:', error);
                        }
                    });
                }
                
                // Update sync status
                if (syncBtn) {
                    syncBtn.disabled = false;
                    syncBtn.textContent = 'Sync Activities';
                }
                
                alert(`Synced ${activities.length} Strava activities successfully!`);
                
            } catch (error) {
                console.error('Error syncing Strava data:', error);
                
                if (syncBtn) {
                    syncBtn.disabled = false;
                    syncBtn.textContent = 'Sync Activities';
                }
                
                alert('Error syncing Strava data: ' + error.message);
            }
        }
        
        function checkStravaConnection() {
            // Check if we have valid tokens
            const accessToken = localStorage.getItem('strava_access_token');
            const tokenExpires = localStorage.getItem('strava_token_expires');
            const athleteName = localStorage.getItem('strava_athlete_name');
            
            const isConnected = accessToken && tokenExpires && new Date(tokenExpires * 1000) > new Date();
            
            const stravaStatus = document.getElementById('stravaStatus');
            const connectBtn = document.getElementById('stravaConnectBtn');
            const disconnectBtn = document.getElementById('stravaDisconnectBtn');
            const syncBtn = document.getElementById('stravaSyncBtn');
            
            if (isConnected) {
                if (stravaStatus) {
                    stravaStatus.innerHTML = `<p>✅ Connected as ${athleteName || 'User'}</p>`;
                }
                if (connectBtn) connectBtn.style.display = 'none';
                if (disconnectBtn) disconnectBtn.style.display = 'block';
                if (syncBtn) syncBtn.style.display = 'block';
            } else {
                if (stravaStatus) {
                    stravaStatus.innerHTML = '<p>Not connected to Strava</p>';
                }
                if (connectBtn) connectBtn.style.display = 'block';
                if (disconnectBtn) disconnectBtn.style.display = 'none';
                if (syncBtn) syncBtn.style.display = 'none';
            }
        }
        
        // Check Strava connection status on page load
        window.addEventListener('load', function() {
            checkStravaConnection();
        });
        
        // Initialize SPA
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize mobile optimizer
            if (window.MobileOptimizer) {
                console.log('Mobile optimizer initialized');
            }
            
            // Initialize season phase
            if (window.SeasonPhase) {
                console.log('Season phase initialized');
                // Ensure phase badge is visible
                window.SeasonPhase.updateUIDisplay();
            }
            
            // Initialize persistent header
            if (window.PersistentHeader) {
                console.log('Persistent header initialized');
            }
            
            // Initialize router
            if (window.Router) {
                console.log('Router initialized');
            }
            
            // Initialize bottom navigation
            if (window.BottomNavigation) {
                console.log('Bottom navigation initialized');
            }
            
            // Initialize dashboard hero
            if (window.DashboardHero) {
                console.log('Dashboard hero initialized');
            }
            
            // Check if user needs onboarding
            if (window.OnboardingManager && window.OnboardingManager.needsOnboarding()) {
                window.Router.navigate('#/onboarding');
            } else {
                window.Router.navigate('#/');
            }
        });
    </script>

    <!-- Expert Coordinator Tests (for manual QA in browser console) -->
    <script src="tests/ai/expert-coordinator-test.js"></script>
    <script src="tests/ai/fixtures.js"></script>
</body>
</html>
