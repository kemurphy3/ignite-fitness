(self.webpackChunkignite_fitness=self.webpackChunkignite_fitness||[]).push([[989],{989:function(e){class t{constructor(){this.logger=window.SafeLogger||console,this.userHistory=this.loadUserHistory(),this.patterns=this.loadPatterns(),this.successMetrics=this.loadSuccessMetrics(),this.cache=new Map,this.cacheExpiry=3e5,this.contextWindow=10,this.costTracker={totalCost:0,calls:0,modelUsage:{}}}loadUserHistory(){try{const e=localStorage.getItem("ai_user_history");return e?JSON.parse(e):{interactions:[],preferences:{},patterns:{},lastUpdated:Date.now()}}catch(e){return this.logger.error("Error loading user history",{error:e.message,stack:e.stack}),{interactions:[],preferences:{},patterns:{},lastUpdated:Date.now()}}}loadPatterns(){try{const e=localStorage.getItem("ai_patterns");return e?JSON.parse(e):{workoutPreferences:{},responsePatterns:{},successPatterns:{},failurePatterns:{}}}catch(e){return this.logger.error("Error loading patterns",{error:e.message,stack:e.stack}),{workoutPreferences:{},responsePatterns:{},successPatterns:{},failurePatterns:{}}}}loadSuccessMetrics(){try{const e=localStorage.getItem("ai_success_metrics");return e?JSON.parse(e):{workoutCompletions:0,goalAchievements:0,userSatisfaction:[],responseEffectiveness:{},lastUpdated:Date.now()}}catch(e){return this.logger.error("Error loading success metrics",{error:e.message,stack:e.stack}),{workoutCompletions:0,goalAchievements:0,userSatisfaction:[],responseEffectiveness:{},lastUpdated:Date.now()}}}saveUserHistory(){try{localStorage.setItem("ai_user_history",JSON.stringify(this.userHistory))}catch(e){this.logger.error("Error saving user history",{error:e.message,stack:e.stack})}}savePatterns(){try{localStorage.setItem("ai_patterns",JSON.stringify(this.patterns))}catch(e){this.logger.error("Error saving patterns",{error:e.message,stack:e.stack})}}saveSuccessMetrics(){try{localStorage.setItem("ai_success_metrics",JSON.stringify(this.successMetrics))}catch(e){this.logger.error("Error saving success metrics",{error:e.message,stack:e.stack})}}addInteraction(e,t,s={}){const r={timestamp:Date.now(),userInput:e,aiResponse:t,context:s,sessionId:this.getCurrentSessionId()};this.userHistory.interactions.push(r),this.userHistory.interactions.length>100&&(this.userHistory.interactions=this.userHistory.interactions.slice(-100)),this.userHistory.lastUpdated=Date.now(),this.saveUserHistory(),this.updatePatterns(r)}getCurrentSessionId(){let e=sessionStorage.getItem("ai_session_id");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("ai_session_id",e)),e}updatePatterns(e){const t=e.userInput.toLowerCase(),s=e.aiResponse.toLowerCase();(t.includes("workout")||t.includes("exercise"))&&(this.patterns.workoutPreferences[e.timestamp]={input:t,context:e.context,timestamp:e.timestamp});const r=this.categorizeResponse(s);this.patterns.responsePatterns[r]||(this.patterns.responsePatterns[r]=[]),this.patterns.responsePatterns[r].push({input:t,response:s,timestamp:e.timestamp}),this.savePatterns()}categorizeResponse(e){const t=e.toLowerCase();return t.includes("workout")||t.includes("exercise")||t.includes("training")||t.includes("gym")?"workout":t.includes("nutrition")||t.includes("diet")||t.includes("eat")||t.includes("food")||t.includes("protein")||t.includes("calories")?"nutrition":t.includes("injury")||t.includes("pain")||t.includes("hurt")||t.includes("ache")||t.includes("rehabilitation")?"injury":t.includes("schedule")||t.includes("time")||t.includes("when")||t.includes("planning")?"schedule":t.includes("goal")||t.includes("progress")||t.includes("achieve")||t.includes("target")?"goal":"workout"}getContextualContext(){return{recentInteractions:this.userHistory.interactions.slice(-this.contextWindow),userProfile:this.getUserProfile(),currentGoals:this.getCurrentGoals(),recentWorkouts:this.getRecentWorkouts(),seasonalContext:this.getSeasonalContext(),patterns:this.patterns,successMetrics:this.successMetrics}}getUserProfile(){try{const e=JSON.parse(localStorage.getItem("users")||"{}");return e[localStorage.getItem("ignitefitness_current_user")]||{}}catch(e){return this.logger.error("Error getting user profile",{error:e.message,stack:e.stack}),{}}}getCurrentGoals(){return this.getUserProfile().goals||{}}getRecentWorkouts(){return(this.getUserProfile().sessions||[]).slice(-5)}getSeasonalContext(){try{const e=localStorage.getItem("seasonalPhase");return e?JSON.parse(e):null}catch(e){return null}}generateContextualPrompt(e,t){const s=this.getContextualContext();let r="You are an AI fitness coach with deep knowledge of the user's history and preferences. ";if(s.userProfile.name&&(r+=`User: ${s.userProfile.name}. `),s.currentGoals.primary&&(r+=`Primary goal: ${s.currentGoals.primary}. `),s.recentWorkouts.length>0){const e=s.recentWorkouts[s.recentWorkouts.length-1];r+=`Last workout: ${e.type||"Unknown"} on ${new Date(e.start_at).toLocaleDateString()}. `}s.seasonalContext&&(r+=`Current training phase: ${s.seasonalContext.phase}. `),s.recentInteractions.length>0&&(r+=`Recent conversation topics: ${s.recentInteractions.slice(-3).map(e=>e.userInput).join(", ")}. `);const n=this.categorizeResponse(e);if(this.patterns.responsePatterns[n]){r+=`Previous similar questions: ${this.patterns.responsePatterns[n].slice(-3).map(e=>e.input).join(", ")}. `}return r+=`\n\nUser's current question: "${e}"\n\nProvide a helpful, personalized response that considers their history and context.`,r}async processUserInput(e,t={}){const s=this.generateCacheKey(e,t),r=this.getCachedResponse(s);if(r)return r;const n=this.generateContextualPrompt(e,t),o=this.selectOptimalModel(e,t),a=await this.getAIResponse(n,e,o);this.cacheResponse(s,a),this.addInteraction(e,a,t);const i=Math.ceil(n.length/4),c=Math.ceil(a.length/4);return this.trackCost(o,i,c),a}async getAIResponse(e,t,s){try{const n=await fetch("/.netlify/functions/ai-proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({method:"POST",endpoint:"/openai/chat/completions",data:{model:s,messages:[{role:"system",content:"You are a knowledgeable fitness coach and nutritionist. Provide helpful, personalized advice based on the user's context and questions."},{role:"user",content:e}],max_tokens:500,temperature:.7}})});if(n.ok){var r;return(null===(r=(await n.json()).choices)||void 0===r||null===(r=r[0])||void 0===r||null===(r=r.message)||void 0===r?void 0:r.content)||"I apologize, but I couldn't generate a response at this time."}{this.logger.warn("AI API call failed, using fallback response",{status:n.status});const e=this.getFallbackResponse(t);return e.message||e}}catch(e){this.logger.warn("AI API call error, using fallback response",{error:e.message,stack:e.stack});const s=this.getFallbackResponse(t);return s.message||s}}getFallbackResponse(e){const t={workout:["Based on your recent training and goals, I recommend focusing on compound movements today. Your last workout was upper body, so let's target lower body with squats, deadlifts, and lunges.","I see you've been consistent with your workouts! For today's session, let's build on your progress with some progressive overload on your main lifts.","Given your athletic profile and recent performance, I suggest incorporating more explosive movements to improve your power output."],nutrition:["Based on your training schedule and goals, you should aim for 1.6-2.2g of protein per kg of body weight. Focus on timing your carbs around your workouts.","I notice you've been training hard. Make sure you're getting enough calories to support your recovery and performance goals.","Your macro targets look good, but consider adding more healthy fats for hormone production and recovery."],injury:["I understand you're experiencing some discomfort. Let's modify your training to work around this while maintaining your progress.","Based on your injury history, I recommend focusing on unilateral exercises and avoiding movements that aggravate the area.","It's important to listen to your body. Let's adjust your training load and add some rehabilitation exercises."],schedule:["I can help you optimize your training schedule based on your availability and goals. What times work best for you?","Looking at your current schedule, I suggest moving your heavy training days to when you have more time and energy.","Let's create a flexible schedule that works with your lifestyle while maintaining consistency."],goal:["Your progress looks great! Let's adjust your training to focus on your specific goals and ensure you're on track.","I can see you're making steady progress. Let's set some short-term milestones to keep you motivated.","Based on your current trajectory, you're on track to reach your goals. Let's fine-tune your approach for optimal results."]},s=this.categorizeResponse(e),r=t[s]||t.workout,n=this.getUserContextForFallback(),o=this.selectDeterministicResponse(r,n);return{message:r[o],responseMetadata:{selectionCriteria:n,category:s,selectedIndex:o,totalOptions:r.length,selectionMethod:"deterministic_context_based"}}}getUserContextForFallback(){var e;const t=this.getUserProfile(),s=this.getRecentWorkouts();return{goals:this.getCurrentGoals().primary||"general_fitness",lastWorkoutType:s.length>0?s[0].type:"none",readinessScore:this.calculateReadinessScore(),experienceLevel:(null===(e=t.personalData)||void 0===e?void 0:e.experience)||"intermediate",trainingFrequency:this.calculateTrainingFrequency(),currentPhase:this.getCurrentTrainingPhase()}}calculateReadinessScore(){const e=this.getRecentWorkouts();if(0===e.length)return.8;const t=e[0],s=(Date.now()-new Date(t.start_at).getTime())/864e5;return s>=3?.9:s>=1?.7:.4}calculateTrainingFrequency(){return this.getRecentWorkouts(14).length/2}selectDeterministicResponse(e,t){return this.createDeterministicSeed(t)%e.length}createDeterministicSeed(e){const t=[e.goals,e.lastWorkoutType,e.experienceLevel,e.currentPhase,Math.floor(10*e.readinessScore),Math.floor(10*e.trainingFrequency)].join("_");let s=0;for(let e=0;e<t.length;e++){s=(s<<5)-s+t.charCodeAt(e),s&=s}return Math.abs(s)}generateCacheKey(e,t){return e.toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,50)}getCachedResponse(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheExpiry?t.response:null}cacheResponse(e,t){this.cache.set(e,{response:t,timestamp:Date.now()})}selectOptimalModel(e,t){const s=this.assessQueryComplexity(e,t);return s<=2?"gpt-3.5-turbo":s<=5?"gpt-4-turbo":"gpt-4"}assessQueryComplexity(e,t){let s=1;return e.length>500&&(s+=2),e.length>1e3&&(s+=2),t.workoutHistory&&t.workoutHistory.length>10&&(s+=1),t.goals&&Object.keys(t.goals).length>3&&(s+=1),t.seasonalContext&&(s+=1),Math.min(s,10)}trackCost(e,t,s){this.costTracker.totalCost+=.001,this.costTracker.calls++,this.costTracker.modelUsage[e]||(this.costTracker.modelUsage[e]={calls:0,cost:0}),this.costTracker.modelUsage[e].calls++,this.costTracker.modelUsage[e].cost+=.001}getUserInsights(){return{totalInteractions:this.userHistory.interactions.length,mostCommonTopics:this.getMostCommonTopics(),responseEffectiveness:this.calculateResponseEffectiveness(),patterns:this.patterns,costSummary:this.costTracker}}getMostCommonTopics(){const e={};return this.userHistory.interactions.forEach(t=>{const s=this.categorizeResponse(t.userInput);e[s]=(e[s]||0)+1}),Object.entries(e).sort(([,e],[,t])=>t-e).slice(0,5).map(([e,t])=>({topic:e,count:t}))}calculateResponseEffectiveness(){return{averageRating:4.2,completionRate:.85,userSatisfaction:.78}}buildUserContext(){var e,t,s,r,n;const o=this.getCurrentUser();if(!o)return{};return{profile:{age:null===(e=o.personalData)||void 0===e?void 0:e.age,weight:null===(t=o.personalData)||void 0===t?void 0:t.weight,height:null===(s=o.personalData)||void 0===s?void 0:s.height,experience:null===(r=o.personalData)||void 0===r?void 0:r.experience,goals:o.goals},recentWorkouts:this.getRecentWorkouts(7),recentSessions:this.getRecentSessions(14),patterns:(null===(n=this.patternDetector)||void 0===n?void 0:n.getUserPatterns())||{},preferences:this.detectUserPreferences(),currentPhase:this.getCurrentTrainingPhase(),lastWorkout:this.getLastWorkout(),nextScheduled:this.getNextScheduledWorkout(),performance:{averageRPE:this.calculateAverageRPE(),volumeTrend:this.calculateVolumeTrend(),consistency:this.calculateConsistency(),progression:this.calculateProgression()},timeOfDay:(new Date).getHours(),dayOfWeek:(new Date).getDay(),season:this.getCurrentSeason(),weather:this.getWeatherContext(),recentQueries:this.getRecentQueries(10),successfulRecommendations:this.getSuccessfulRecommendations(),lastSync:this.getLastSyncTime(),offlineMode:!navigator.onLine,dataQuality:this.assessDataQuality()}}detectUserPreferences(){const e=this.getRecentWorkouts(30);return{preferredTimes:this.analyzePreferredWorkoutTimes(e),favoriteExercises:this.analyzeFavoriteExercises(e),intensityPreference:this.analyzeIntensityPreference(e),sessionLength:this.analyzePreferredSessionLength(e),restDayPattern:this.analyzeRestDayPattern(e)}}getCurrentTrainingPhase(){const e=this.getCurrentUser();return e&&e.trainingPhase||"off-season"}getLastWorkout(){return this.getRecentWorkouts(1)[0]||null}getNextScheduledWorkout(){const e=this.getCurrentUser();if(null==e||!e.workoutPlan)return null;const t=new Date,s=new Date(t);s.setDate(s.getDate()+1);for(let s=0;s<7;s++){const r=new Date(t);r.setDate(r.getDate()+s);const n=e.workoutPlan[r.getDay()];if(n&&n.sessions&&n.sessions.length>0)return{date:r,sessions:n.sessions}}return null}calculateAverageRPE(){const e=this.getRecentWorkouts(14);if(0===e.length)return 0;return e.reduce((e,t)=>e+(t.averageRPE||0),0)/e.length}calculateVolumeTrend(){const e=this.getRecentWorkouts(14);if(e.length<2)return"stable";const t=e.slice(0,7),s=e.slice(7,14),r=this.calculateTotalVolume(t),n=this.calculateTotalVolume(s),o=(r-n)/n;return o>.1?"increasing":o<-.1?"decreasing":"stable"}calculateConsistency(){return this.getRecentWorkouts(30).length/30}calculateProgression(){const e=this.getRecentWorkouts(30);if(e.length<2)return 0;let t=0;for(let s=1;s<e.length;s++){const r=e[s],n=e[s-1];r.averageWeight>n.averageWeight&&t++}return t/(e.length-1)}getRecentSessions(e){var t;const s=this.getCurrentUser();if(null==s||null===(t=s.data)||void 0===t||!t.sessions)return[];const r=new Date;return r.setDate(r.getDate()-e),s.data.sessions.filter(e=>new Date(e.start_at)>=r).sort((e,t)=>new Date(t.start_at)-new Date(e.start_at))}analyzePreferredWorkoutTimes(e){const t={};return e.forEach(e=>{const s=new Date(e.start_at).getHours(),r=s<12?"morning":s<17?"afternoon":"evening";t[r]=(t[r]||0)+1}),Object.entries(t).sort(([,e],[,t])=>t-e).map(([e,t])=>({time:e,count:t}))}analyzeFavoriteExercises(e){const t={};return e.forEach(e=>{e.exercises&&e.exercises.forEach(e=>{t[e.name]=(t[e.name]||0)+1})}),Object.entries(t).sort(([,e],[,t])=>t-e).slice(0,10).map(([e,t])=>({exercise:e,count:t}))}analyzeIntensityPreference(e){const t=e.map(e=>e.averageRPE).filter(e=>e>0);if(0===t.length)return"moderate";const s=t.reduce((e,t)=>e+t,0)/t.length;return s>=8?"high":s<=5?"low":"moderate"}analyzePreferredSessionLength(e){const t=e.map(e=>e.duration).filter(e=>e>0);if(0===t.length)return 60;const s=t.reduce((e,t)=>e+t,0)/t.length;return s<=30?"short":s<=60?"medium":"long"}analyzeRestDayPattern(e){const t=e.map(e=>new Date(e.start_at).getDay()),s={};for(let e=0;e<7;e++)s[e]=t.filter(t=>t===e).length;return s}calculateTotalVolume(e){return e.reduce((e,t)=>t.exercises?e+t.exercises.reduce((e,t)=>e+t.weight*t.reps*t.sets,0):e,0)}getCurrentSeason(){const e=(new Date).getMonth();return e>=2&&e<=4?"spring":e>=5&&e<=7?"summer":e>=8&&e<=10?"fall":"winter"}getWeatherContext(){return{temperature:"moderate",conditions:"clear",humidity:"normal"}}getRecentQueries(e){return this.interactionHistory.slice(-e).map(e=>e.query).reverse()}getSuccessfulRecommendations(){return this.interactionHistory.filter(e=>e.rating>=4).map(e=>e.response).slice(-5)}getLastSyncTime(){return localStorage.getItem("ignitefitness_last_sync")||null}assessDataQuality(){var e,t,s,r,n;const o=this.getCurrentUser();if(!o)return"poor";let a=0;null!==(e=o.personalData)&&void 0!==e&&e.age&&(a+=1),null!==(t=o.personalData)&&void 0!==t&&t.weight&&(a+=1),null!==(s=o.personalData)&&void 0!==s&&s.height&&(a+=1),null!==(r=o.goals)&&void 0!==r&&r.primary&&(a+=1);const i=(null===(n=o.data)||void 0===n||null===(n=n.sessions)||void 0===n?void 0:n.filter(e=>"workout"===e.type).length)||0;return i>=10?a+=2:i>=5&&(a+=1),a>=6?"excellent":a>=4?"good":a>=2?"fair":"poor"}getCurrentUser(){const e=localStorage.getItem("ignitefitness_current_user");if(!e)return null;return JSON.parse(localStorage.getItem("ignitefitness_users")||"{}")[e]||null}analyzeQueryComplexity(e,t){const s=e.length,r=e.split(" ").length,n=e.includes("?");let o=0;return s>500?o+=2:s>200&&(o+=1),r>50?o+=2:r>20&&(o+=1),this.hasTechnicalTerms(e)&&(o+=2),this.requiresAnalysis(e)&&(o+=3),this.requiresExpertise(e)&&(o+=3),n&&(o+=1),t.requiresExpertise&&(o+=2),t.requiresAnalysis&&(o+=2),"injury"===t.queryType&&(o+=3),"research"===t.queryType&&(o+=4),o>=8?{level:"expert",score:o}:o>=5?{level:"complex",score:o}:o>=2?{level:"standard",score:o}:{level:"simple",score:o}}hasTechnicalTerms(e){const t=e.toLowerCase();return["rpe","rm","1rm","volume","intensity","periodization","hypertrophy","strength","endurance","power","speed","agility","flexibility","mobility","stability","balance","proprioception","kinesthetic","biomechanics","physiology","metabolism","hormones","recovery","adaptation","overload","progression","regression","deload","taper","peaking"].some(e=>t.includes(e))}requiresAnalysis(e){const t=e.toLowerCase();return["analyze","analysis","compare","evaluate","assess","review","examine","study","research","investigate","why","how","what if","explain","describe in detail"].some(e=>t.includes(e))}requiresExpertise(e){const t=e.toLowerCase();return["injury","pain","rehabilitation","therapy","medical","doctor","physician","therapist","specialist","expert","diagnosis","treatment","condition","symptom","recovery","prevention","risk","safety","warning","caution"].some(e=>t.includes(e))}async callAIAPI(e,t){const s={"claude-haiku":`Quick response for: "${e.substring(0,50)}..."`,"gpt-3.5-turbo":`Standard response for: "${e.substring(0,50)}..."`,"claude-sonnet":`Detailed response for: "${e.substring(0,50)}..."`,"claude-opus":`Expert analysis for: "${e.substring(0,50)}..."`};return await new Promise(e=>setTimeout(e,1e3)),s[t.name.toLowerCase().replace(" ","-")]||"AI response"}generateFallbackResponse(e,t){return{"claude-haiku":"I understand your question. Let me provide a quick answer.","gpt-3.5-turbo":"I can help you with that. Here's what I recommend.","claude-sonnet":"That's an interesting question. Let me give you a detailed response.","claude-opus":"This requires expert analysis. Let me provide comprehensive guidance."}[t.name.toLowerCase().replace(" ","-")]||"I'm here to help!"}trackModelUsage(e,t,s){this.modelUsage||(this.modelUsage={});const r=e.name.toLowerCase().replace(" ","-");this.modelUsage[r]||(this.modelUsage[r]={calls:0,inputTokens:0,outputTokens:0,totalCost:0});const n=this.modelUsage[r];n.calls++,n.inputTokens+=t,n.outputTokens+=s,n.totalCost+=this.calculateCost(t,s,e.costPer1kTokens),localStorage.setItem("ignitefitness_model_usage",JSON.stringify(this.modelUsage))}calculateCost(e,t,s){return(e+t)/1e3*s}getModelUsageStats(){return this.modelUsage||{}}estimateCost(e,t,s){const r=Math.ceil(e.length/4),n=Math.ceil(t.length/4);return this.calculateCost(r,n,s.costPer1kTokens)}}e.exports?e.exports={ContextAwareAI:t}:window.ContextAwareAI=t}}]);
//# sourceMappingURL=989.174c0ce924c9051d2ae8.chunk.js.map